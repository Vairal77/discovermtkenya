const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-react-BNFt8q1m.js","assets/vendor-utils-D77wr3qA.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,ai as De,aj as Ae,ak as Me,al as Pe,X as Ee,am as Te,an as Le,ao as Cs,ap as Ss,aq as ks,ar as Oe,as as Is,at as Fe,au as Ds,av as Ke,aw as ue,ax as As,ay as Ms,w as F,v as Y,az as Re,aA as U,aB as Z,x as L,u as O,aC as Ps,aD as Be,aE as $e,aF as qe,aG as ze,aH as _e,aI as Ue,aJ as Es,aK as Ts,aL as Ls,aM as Os,aN as Fs,aO as Ve,m as pe,a4 as We,a5 as V,aP as Ks,aQ as ge,aR as Qe,aS as re,aT as He,aU as fe,aV as je,a8 as Ge,W as Rs,a9 as ne,aW as Bs,aX as $s,B as be,aY as X,N as Ne,K as z,aZ as we,a_ as qs,J as zs,a$ as _s,b0 as Us,b1 as Ce,b2 as Vs,b3 as Ws,b4 as Qs,b5 as Ye,b6 as Je,b7 as Hs,a7 as Gs,ab as Ys,b8 as Xe,b9 as Ze,ba as Js,bb as Xs,bc as Zs,bd as xe,be as es,E as et,bf as st,bg as tt,bh as at,ad as Se,bi as rt,y as nt,bj as it,bk as lt,bl as ot,bm as ct,bn as dt,bo as mt,bp as ut,bq as xt,br as ht,bs as M,bt as pt,bu as gt}from"./vendor-react-BNFt8q1m.js";import{a as ft}from"./vendor-utils-D77wr3qA.js";import{c as P,l as ie,L as I,I as E,B as k,s as b,S as W,a as Q,b as H,d as G,e as v,f as ss,p as q,g as $,m as jt,i as vt,D as ts,h as as,j as rs,k as ns,T as is,C as ee,n as se,o as le,q as oe,r as yt,A as bt,t as Nt,u as wt,v as Ct,w as St,x as kt}from"./admin-Bvz7KFKr.js";import{_ as It}from"./vendor-supabase-DBst6vn8.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const Dt=1,At=1e6;let ce=0;function Mt(){return ce=(ce+1)%Number.MAX_SAFE_INTEGER,ce.toString()}const de=new Map,ke=s=>{if(de.has(s))return;const t=setTimeout(()=>{de.delete(s),J({type:"REMOVE_TOAST",toastId:s})},At);de.set(s,t)},Pt=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,Dt)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?ke(a):s.toasts.forEach(o=>{ke(o.id)}),{...s,toasts:s.toasts.map(o=>o.id===a||a===void 0?{...o,open:!1}:o)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},te=[];let ae={toasts:[]};function J(s){ae=Pt(ae,s),te.forEach(t=>{t(ae)})}function Et({...s}){const t=Mt(),a=r=>J({type:"UPDATE_TOAST",toast:{...r,id:t}}),o=()=>J({type:"DISMISS_TOAST",toastId:t});return J({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:r=>{r||o()}}}),{id:t,dismiss:o,update:a}}function Tt(){const[s,t]=c.useState(ae);return c.useEffect(()=>(te.push(t),()=>{const a=te.indexOf(t);a>-1&&te.splice(a,1)}),[s]),{...s,toast:Et,dismiss:a=>J({type:"DISMISS_TOAST",toastId:a})}}const Lt=Cs,ls=c.forwardRef(({className:s,...t},a)=>e.jsx(De,{ref:a,className:P("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));ls.displayName=De.displayName;const Ot=ft("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),os=c.forwardRef(({className:s,variant:t,...a},o)=>e.jsx(Ae,{ref:o,className:P(Ot({variant:t}),s),...a}));os.displayName=Ae.displayName;const Ft=c.forwardRef(({className:s,...t},a)=>e.jsx(Me,{ref:a,className:P("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));Ft.displayName=Me.displayName;const cs=c.forwardRef(({className:s,...t},a)=>e.jsx(Pe,{ref:a,className:P("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Ee,{className:"h-4 w-4"})}));cs.displayName=Pe.displayName;const ds=c.forwardRef(({className:s,...t},a)=>e.jsx(Te,{ref:a,className:P("text-sm font-semibold",s),...t}));ds.displayName=Te.displayName;const ms=c.forwardRef(({className:s,...t},a)=>e.jsx(Le,{ref:a,className:P("text-sm opacity-90",s),...t}));ms.displayName=Le.displayName;function Kt(){const{toasts:s}=Tt();return e.jsxs(Lt,{children:[s.map(function({id:t,title:a,description:o,action:r,...l}){return e.jsxs(os,{...l,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(ds,{children:a}),o&&e.jsx(ms,{children:o})]}),r,e.jsx(cs,{})]},t)}),e.jsx(ls,{})]})}const Rt=({...s})=>{const{theme:t="system"}=Ss();return e.jsx(ks,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Bt=Is,$t=c.forwardRef(({className:s,sideOffset:t=4,...a},o)=>e.jsx(Oe,{ref:o,sideOffset:t,className:P("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));$t.displayName=Oe.displayName;const us=c.forwardRef(({className:s,value:t,...a},o)=>e.jsx(Fe,{ref:o,className:P("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(Ds,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));us.displayName=Fe.displayName;const qt=({progress:s,status:t,isComplete:a,isVisible:o})=>e.jsx(Ke,{children:o&&e.jsx(ue.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"fixed bottom-24 left-4 right-4 z-[60] max-w-lg mx-auto",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-md dark:bg-slate-900/95 border border-primary/20 shadow-2xl rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(As,{className:"w-5 h-5 text-green-500"}):e.jsx(Ms,{className:"w-5 h-5 text-primary animate-bounce"}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:a?"App Ready Offline":"Syncing Offline Content"})]}),e.jsxs("span",{className:"text-xs font-medium text-primary",children:[Math.round(s),"%"]})]}),e.jsx(us,{value:s,className:"h-2 bg-primary/10"}),e.jsx("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest text-center font-medium",children:t})]})})});function zt(){const s=F();return c.useEffect(()=>{const t=setTimeout(()=>{s("/home")},4e3);return()=>clearTimeout(t)},[s]),e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:e.jsx("div",{className:"relative w-full max-w-md aspect-square mx-auto",children:e.jsx("img",{src:"media/splash.gif",alt:"Loading...",className:"w-full h-full object-contain"})})})}function Ie(){var j;const s=F(),t=Y(),[a,o]=c.useState(""),[r,l]=c.useState(""),[d,m]=c.useState(!1),[n,p]=c.useState(!1),f=((j=t.state)==null?void 0:j.returnTo)||"/home",i=u=>{u.preventDefault(),p(!0),setTimeout(()=>{const x=b.getUsers().find(S=>S.username===a&&S.password===r);x?(b.setCurrentUser(x),O.success(`Welcome back, ${x.fullName}!`),x.role==="admin"?s("/admin"):s(f)):O.error("Invalid username or password"),p(!1)},500)};return e.jsx("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6 animate-slide-left-fade",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-24 w-auto mx-auto mb-4 object-contain"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Discover Mount Kenya"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Sign in to continue"})]}),e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"username",children:"Username"}),e.jsx(E,{id:"username",type:"text",placeholder:"Enter your username",value:a,onChange:u=>o(u.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{id:"password",type:d?"text":"password",placeholder:"Enter your password",value:r,onChange:u=>l(u.target.value),required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>m(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:d?e.jsx(Re,{className:"w-4 h-4"}):e.jsx(U,{className:"w-4 h-4"})})]})]}),e.jsx(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 font-semibold",disabled:n,children:n?"Logging in...":"Login"})]}),e.jsxs(k,{type:"button",onClick:()=>s("/home"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-purple-300 hover:border-purple-400 bg-purple-50 hover:bg-purple-100 text-purple-700",children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Return to Home"]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(L,{to:"/create-account",className:"text-primary font-medium hover:underline",children:"Create Account"})]})})]})})}function _t(){var n;const s=F(),t=Y(),[a,o]=c.useState(!1),r=((n=t.state)==null?void 0:n.returnTo)||"/home",[l,d]=c.useState({fullName:"",password:"",phone:"",location:""}),m=p=>{p.preventDefault();const f=b.getUsers(),i={id:Date.now().toString(),username:l.fullName.split(" ")[0],password:l.password,fullName:l.fullName,phone:l.phone,location:l.location,role:"user"};f.push(i),b.saveUsers(f),b.setCurrentUser(i),O.success("Account created successfully!"),s(r)};return e.jsx("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:e.jsxs("div",{className:"max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-20 w-auto mx-auto mb-4 object-contain"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Create Account"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Join Discover Mount Kenya"})]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"fullName",children:"Full Name"}),e.jsx(E,{id:"fullName",type:"text",placeholder:"Enter your full name",value:l.fullName,onChange:p=>d({...l,fullName:p.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{id:"password",type:a?"text":"password",placeholder:"Create a password",value:l.password,onChange:p=>d({...l,password:p.target.value}),required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>o(!a),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:a?e.jsx(Re,{className:"w-4 h-4"}):e.jsx(U,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"phone",children:"Phone Number"}),e.jsx(E,{id:"phone",type:"tel",placeholder:"+254700000000",value:l.phone,onChange:p=>d({...l,phone:p.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"location",children:"Delivery Location"}),e.jsxs(W,{value:l.location,onValueChange:p=>d({...l,location:p}),required:!0,children:[e.jsx(Q,{children:e.jsx(H,{placeholder:"Select your location"})}),e.jsxs(G,{children:[e.jsx(v,{value:"CBD",children:"CBD"}),e.jsx(v,{value:"Mukima",children:"Mukima"}),e.jsx(v,{value:"Baraka",children:"Baraka"}),e.jsx(v,{value:"Mugambi",children:"Mugambi"}),e.jsx(v,{value:"Katheri",children:"Katheri"}),e.jsx(v,{value:"MKWE",children:"MKWE"}),e.jsx(v,{value:"Likii",children:"Likii"}),e.jsx(v,{value:"Makutano",children:"Makutano"}),e.jsx(v,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsx(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 h-12 font-semibold",children:"Create Account"})]}),e.jsxs("div",{className:"space-y-3 mt-6",children:[e.jsxs(k,{type:"button",onClick:()=>s("/login"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-blue-300 hover:border-blue-400 bg-blue-50 hover:bg-blue-100 text-blue-700",children:[e.jsx(Ps,{className:"w-5 h-5 mr-2"}),"Back to Login"]}),e.jsxs(k,{type:"button",onClick:()=>s("/home"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-purple-300 hover:border-purple-400 bg-purple-50 hover:bg-purple-100 text-purple-700",children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Return to Home"]})]}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["Already have an account?"," ",e.jsx(L,{to:"/login",className:"text-primary font-medium hover:underline",children:"Sign in"})]})]})})}const Ut=Ts,Vt=Es,xs=c.forwardRef(({className:s,...t},a)=>e.jsx(Be,{className:P("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));xs.displayName=Be.displayName;const hs=c.forwardRef(({className:s,...t},a)=>e.jsxs(Vt,{children:[e.jsx(xs,{}),e.jsx($e,{ref:a,className:P("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));hs.displayName=$e.displayName;const ps=({className:s,...t})=>e.jsx("div",{className:P("flex flex-col space-y-2 text-center sm:text-left",s),...t});ps.displayName="AlertDialogHeader";const gs=({className:s,...t})=>e.jsx("div",{className:P("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});gs.displayName="AlertDialogFooter";const fs=c.forwardRef(({className:s,...t},a)=>e.jsx(qe,{ref:a,className:P("text-lg font-semibold",s),...t}));fs.displayName=qe.displayName;const js=c.forwardRef(({className:s,...t},a)=>e.jsx(ze,{ref:a,className:P("text-sm text-muted-foreground",s),...t}));js.displayName=ze.displayName;const vs=c.forwardRef(({className:s,...t},a)=>e.jsx(_e,{ref:a,className:P(ss(),s),...t}));vs.displayName=_e.displayName;const ys=c.forwardRef(({className:s,...t},a)=>e.jsx(Ue,{ref:a,className:P(ss({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));ys.displayName=Ue.displayName;function bs({open:s,onConfirm:t,onCancel:a}){return e.jsx(Ut,{open:s,onOpenChange:o=>!o&&a(),children:e.jsxs(hs,{className:"max-w-md border-2 border-primary/20",children:[e.jsxs(ps,{children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full mb-4 w-fit",children:e.jsx(Ls,{className:"w-12 h-12 text-primary"})}),e.jsx(fs,{className:"text-2xl text-center font-bold text-primary",children:"Age Verification Required"}),e.jsxs(js,{className:"text-center text-base mt-2",children:["You must be 18 years or older to enter the Beverages section.",e.jsx("br",{}),e.jsx("br",{}),"Are you 18 years of age or older?"]})]}),e.jsxs(gs,{className:"sm:justify-center gap-4 mt-4",children:[e.jsx(ys,{onClick:a,className:"w-full sm:w-auto min-w-[120px]",children:"No, I'm under 18"}),e.jsx(vs,{onClick:t,className:"w-full sm:w-auto min-w-[120px] bg-primary hover:bg-primary/90",children:"Yes, I'm 18+"})]})]})})}function _(){const s=[{to:"/home",icon:Z,label:"Home"},{to:"/categories",icon:Fs,label:"Categories"},{to:"/settings",icon:Ve,label:"About Us"}];return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border z-50 safe-area-bottom",children:e.jsx("div",{className:"flex items-center justify-around h-16 max-w-lg mx-auto px-2",children:s.map(({to:t,icon:a,label:o})=>e.jsxs(Os,{to:t,className:({isActive:r})=>`flex flex-col items-center justify-center flex-1 h-full transition-colors ${r?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(a,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:o})]},t))})})}function R(){const[s,t]=c.useState(b.getCurrentUser());return c.useEffect(()=>{const a=setInterval(()=>{const o=b.getCurrentUser();t(o)},500);return()=>clearInterval(a)},[]),c.useEffect(()=>{const a=b.getCurrentUser();t(a)},[]),c.useEffect(()=>{const a=()=>{const r=b.getCurrentUser();t(r)},o=()=>{t(null)};return window.addEventListener("storage",a),window.addEventListener("focus",a),window.addEventListener("userLogout",o),()=>{window.removeEventListener("storage",a),window.removeEventListener("focus",a),window.removeEventListener("userLogout",o)}},[]),e.jsx("header",{className:"bg-card border-b border-border sticky top-0 z-40",children:e.jsx("div",{className:"max-w-lg mx-auto px-4 py-4 flex items-center justify-between",children:e.jsx(L,{to:"/home",className:"cursor-pointer",children:e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-10 w-auto object-contain"})})})},(s==null?void 0:s.id)||"no-user")}function ve({className:s="",type:t="home"}){const[a,o]=c.useState(!0),[r,l]=c.useState(!1),d="https://raw.githubusercontent.com/Vairal77/discovermtkenya/main/public/media",[m,n]=c.useState(`${d}/${t}hero.jpg?t=${new Date().getTime()}`),[p,f]=c.useState(!1);return c.useEffect(()=>{const i=new Image;i.src=m,i.onload=()=>{o(!1),l(!1)},i.onerror=()=>{p?(console.error(`Failed to load hero image fallback: ${m}`),o(!1),l(!0)):(console.warn(`Failed to load GitHub image, falling back to local: ${m}`),f(!0),n(`media/${t}hero.jpg`))}},[m,p,t]),e.jsxs("div",{className:`rounded-2xl overflow-hidden shadow-card bg-muted relative ${s}`,style:{aspectRatio:"16/9"},children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 dark:bg-zinc-800 flex items-center justify-center z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(pe,{className:"w-8 h-8 animate-spin text-green-600"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Loading experience..."})]})}),r?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-zinc-100 dark:bg-zinc-900",children:e.jsx("p",{className:"text-sm text-zinc-500",children:"Discover Mt Kenya"})}):e.jsx("img",{src:m,alt:`${t} advertisement`,className:"w-full h-full object-cover transition-opacity duration-500",style:{opacity:a?0:1}})]})}function Wt(){const[s,t]=c.useState(b.getCurrentUser()),[a,o]=c.useState(!1),r=We(),{data:l=[],isLoading:d,error:m}=V({queryKey:["partners","promoted","home"],queryFn:()=>q.getPromoted(10),staleTime:1e3*60,gcTime:1e3*300,refetchOnMount:!0,retry:3,retryDelay:y=>Math.min(1e3*2**y,1e4)}),n=c.useMemo(()=>[...l].sort(()=>Math.random()-.5).slice(0,2),[l]);c.useEffect(()=>{let y=null;const N=q.onChanges(()=>{y&&clearTimeout(y),y=setTimeout(()=>{r.invalidateQueries({queryKey:["partners","promoted","home"]})},1500)});return()=>{y&&clearTimeout(y),N()}},[r]),c.useEffect(()=>{if(s){const y=b.getOrders().filter(N=>N.userId===s.id&&N.status==="delivered"&&!N.rated);o(y.length>0)}},[s]);const p=[{name:"Accommodation",icon:Z,color:"text-primary",link:"/category/accommodation"},{name:"Food Delivery",icon:ge,color:"text-destructive",link:"/category/restaurants"},{name:"Beverages",icon:Qe,color:"text-accent",link:"/category/beverages"},{name:"Activities",icon:re,color:"text-success",link:"/category/activities"},{name:"Attractions",icon:He,color:"text-purple-500",link:"/category/attractions"},{name:"Shop",icon:fe,color:"text-orange-500",link:"/category/shop"}],f=F(),[i,j]=c.useState(!1),[u,C]=c.useState(null),x=async(y,N,g)=>{if(y.preventDefault(),N==="Beverages"){C(g),j(!0);return}if(N==="Food Delivery"){f(g);return}f(g)},S=async()=>{j(!1),f(u||"/category/beverages"),C(null)};return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-fade-in-up",children:[e.jsx(R,{}),e.jsx(bs,{open:i,onConfirm:S,onCancel:()=>{j(!1),C(null)}}),a&&s&&e.jsx("div",{className:"max-w-lg mx-auto px-4 py-2",children:e.jsx(L,{to:"/orders",className:"block",children:e.jsxs("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-3 flex items-center gap-3 hover:bg-yellow-200 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-500 text-white rounded-full flex items-center justify-center",children:e.jsx(Ks,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Rate Your Orders"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"You have delivered orders waiting for your review"})]})]})})}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsx(ve,{type:"home"}),!d&&n.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Featured"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map(y=>e.jsxs(L,{to:`/business/${y.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx($,{src:Array.isArray(y.image)?y.image[0]:y.image,alt:y.name,className:"w-full h-32 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:y.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:y.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",y.rating]})]})]},y.id))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Categories"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:p.map(y=>{const N=y.icon,g={Accommodation:"from-primary via-primary/90 to-primary/80","Food Delivery":"from-red-500 via-red-400 to-red-300",Beverages:"from-blue-500 via-blue-400 to-blue-300",Activities:"from-green-500 via-green-400 to-green-300",Attractions:"from-purple-500 via-purple-400 to-purple-300",Shop:"from-orange-500 via-orange-400 to-orange-300"}[y.name]||"from-gray-500 via-gray-400 to-gray-300";return e.jsxs("a",{href:y.link,onClick:D=>x(D,y.name,y.link),className:`bg-gradient-to-br ${g} rounded-xl p-6 shadow-lg hover:shadow-xl transition-all hover:scale-105 border-2 border-white/20 block cursor-pointer`,children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 text-white drop-shadow-lg"}),e.jsx("p",{className:"text-center font-bold text-sm text-white drop-shadow-md",children:y.name})]},y.name)})})]})]}),e.jsx(_,{})]})}function Qt(){const s=F(),[t,a]=c.useState(!1),[o,r]=c.useState(null),l=We();V({queryKey:["partners","categories"],queryFn:()=>q.getAll(),refetchOnMount:!0,retry:3,retryDelay:u=>Math.min(1e3*2**u,1e4)});const{data:d=[],isLoading:m}=V({queryKey:["partners","promoted","categories"],queryFn:()=>q.getPromoted(10),refetchOnMount:!0,retry:3,retryDelay:u=>Math.min(1e3*2**u,1e4)}),n=c.useMemo(()=>[...d].sort(()=>Math.random()-.5).slice(0,2),[d]);c.useEffect(()=>{let u=null;const C=q.onChanges(()=>{u&&clearTimeout(u),u=setTimeout(()=>{l.invalidateQueries({queryKey:["partners","categories"]}),l.invalidateQueries({queryKey:["partners","promoted","categories"]})},1500)});return()=>{u&&clearTimeout(u),C()}},[l]);const p=[{name:"Accommodation",icon:Z,color:"from-primary via-primary/90 to-primary/80",path:"/category/accommodation"},{name:"Food Delivery",icon:ge,color:"from-red-500 via-red-400 to-red-300",path:"/category/restaurants"},{name:"Beverages",icon:Qe,color:"from-blue-500 via-blue-400 to-blue-300",path:"/category/beverages"},{name:"Activities",icon:re,color:"from-green-500 via-green-400 to-green-300",path:"/category/activities"},{name:"Attractions",icon:He,color:"from-purple-500 via-purple-400 to-purple-300",path:"/category/attractions"},{name:"Shop",icon:fe,color:"from-orange-500 via-orange-400 to-orange-300",path:"/category/shop"}],f=u=>({Accommodation:"https://images.unsplash.com/photo-1578683010236-d716f9a3f461?w=800","Food Delivery":"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800",Beverages:"https://images.unsplash.com/photo-1556679343-c7306c1976bc?w=800",Activities:"https://images.unsplash.com/photo-1551632811-561732d1e306?w=800",Attractions:"https://images.unsplash.com/photo-1516426122078-c23e76319801?w=800",Shop:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=800"})[u]||"https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=800",i=async(u,C,x)=>{if(u.preventDefault(),C==="Beverages"){r(x),a(!0);return}if(C==="Food Delivery"){s(x);return}s(x)},j=async()=>{a(!1),s(o||"/category/beverages"),r(null)};return e.jsxs("div",{className:"relative min-h-screen bg-background pb-20 animate-fade-in-up",children:[e.jsx(R,{}),e.jsx(bs,{open:t,onConfirm:j,onCancel:()=>{a(!1),r(null)}}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-2 space-y-6",children:[e.jsx(ve,{type:"categories"}),n.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Featured"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:n.map(u=>e.jsxs(L,{to:`/business/${u.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx($,{src:Array.isArray(u.image)?u.image[0]:u.image,alt:u.name,className:"w-full h-32 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:u.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:u.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",u.rating]})]})]},u.id))})]}),p.map(u=>e.jsxs("a",{href:u.path,onClick:C=>i(C,u.name,u.path),className:"block relative bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-all hover:scale-[1.02] cursor-pointer",children:[e.jsx($,{src:f(u.name),alt:u.name,className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:u.name}),e.jsx("p",{className:"text-sm text-white/90",children:u.name==="Food Delivery"?"Explore meal options":`Explore ${u.name.toLowerCase()} options`})]})]},u.name))]}),e.jsx(_,{})]})}function Ht(){const{category:s}=je();F();const[t,a]=c.useState(""),{data:o=[],isLoading:r,error:l,isFetching:d}=V({queryKey:["partners","category",s],queryFn:()=>s?q.getByCategory(s,{pageSize:100}):[],enabled:!!s,retry:3,retryDelay:i=>Math.min(1e3*2**i,1e4),refetchOnMount:!0,placeholderData:i=>i}),m=c.useMemo(()=>o.filter(i=>{var j;return i.name.toLowerCase().includes(t.toLowerCase())||((j=i.description)==null?void 0:j.toLowerCase().includes(t.toLowerCase()))}),[o,t]),n=i=>i.category==="accommodation"?i.pricePerNight?`KES ${i.pricePerNight.toLocaleString()}/night`:"Prices in KES":i.category==="activities"&&i.pricePerPerson?`KES ${i.pricePerPerson.toLocaleString()}/person`:"Prices in KES",f=(i=>{const j=i==null?void 0:i.toLowerCase();return j==="restaurants"||j==="food delivery"?"Food Delivery":j==="beverages"?"Beverages":j==="shop"||j==="dmk shop"?"DMK Shop":i==null?void 0:i.replace("-"," ").replace(/\b\w/g,u=>u.toUpperCase())})(s||"");return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(E,{placeholder:`Search ${f}...`,value:t,onChange:i=>a(i.target.value),className:"pl-9 bg-card/50 border-muted-foreground/20 focus-visible:ring-primary/20 transition-all hover:bg-card/80"})]}),e.jsx("h1",{className:"text-2xl font-bold px-1",children:f}),r&&o.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]}),l&&!r&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Rs,{className:"w-12 h-12 mx-auto mb-4 text-red-500"}),e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Failed to load content"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm",children:"Retry"})]}),m.map(i=>e.jsxs(L,{to:`/business/${i.id}`,className:"block bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx($,{src:Array.isArray(i.image)?i.image[0]:i.image,alt:i.name,className:"w-full h-48 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:i.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4 text-primary fill-primary"}),i.rating]}),i.category==="accommodation"&&i.propertyType&&e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary rounded-full font-medium",children:i.propertyType}),e.jsx("span",{className:"capitalize",children:i.category==="restaurant"?"Food Delivery":i.category}),e.jsx("span",{children:n(i)})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:i.description}),e.jsxs("div",{className:"inline-flex items-center gap-2 text-primary font-medium",children:[e.jsx(U,{className:"w-4 h-4"}),i.category==="accommodation"?"View Property":i.category==="activities"?"View Activity":i.category==="restaurant"?"View Restaurants":i.category==="beverage"?"View Beverages":"View Details"]})]})]},i.id)),!r&&o.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground mb-4",children:"No items found in this category."})})]}),e.jsx(_,{})]})}function Gt({message:s="Loading...",fullscreen:t=!0,className:a}){return e.jsx("div",{className:P("z-50 flex items-center justify-center bg-background/90 text-center text-sm text-muted-foreground backdrop-blur",t?"fixed inset-0":"absolute inset-0",a),children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(pe,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"font-medium text-foreground/80",children:s})]})})}function Yt(){var K,A;const{id:s}=je(),t=F(),[a,o]=c.useState(0),[r,l]=c.useState(""),[d,m]=c.useState([]),{data:n,isLoading:p}=V({queryKey:["partner",s],queryFn:()=>s?q.getById(s):null,enabled:!!s}),{data:f=[],isLoading:i}=V({queryKey:["menu",s],queryFn:()=>s?jt.getByPartner_id(s):[],enabled:!!s&&!!n}),j=c.useMemo(()=>f.filter(h=>h.name.toLowerCase().includes(r.toLowerCase())||h.description.toLowerCase().includes(r.toLowerCase())),[f,r]),u=p||i;c.useEffect(()=>{n&&n.category&&(async()=>{const h=await q.getSimilar(n.category,n.id,2);m(h)})()},[n]);const C=c.useMemo(()=>f.length===0?null:f.reduce((w,T)=>w+(T.price||0),0)/f.length,[f]),x=async h=>{if(!n)return;const w=n.category==="accommodation"?n.pricePerNight??null:n.category==="activities"?n.pricePerPerson??null:(n.category==="restaurant"||n.category==="beverage")&&C?C:null;await vt.logInteraction({partnerId:n.id,partnerCategory:n.category,actionType:n.category==="restaurant"||n.category==="beverage"?"order_call":n.category==="activities"?"activity_call":"book_call",actionSource:h,estimatedValue:w,deviceType:/Mobi|Android/i.test(navigator.userAgent)?"mobile":"desktop",metadata:{partnerName:n.name}})},S=async(h,w)=>{await x(w),window.location.href=`tel:${h}`},y=h=>({"Swimming Pool":qs,Activities:zs,"Delivery Services":z,"Amazing Views":U,"Spacious Living":_s,Bathtub:Us,"Serene Location":re})[h]||U,N=h=>({"Self Catering":Ce,WiFi:Vs,Toiletries:Ws,"Coffee/Tea Station":we,"Chef's Kitchen":Ce,"Smart TV":Qs})[h]||U;if(u)return e.jsxs("div",{className:"relative min-h-screen bg-background",children:[e.jsx(R,{}),e.jsx(Gt,{message:"Loading partner details..."})]});if(!n&&!u)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold mb-2",children:"Partner not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The partner you're looking for doesn't exist."}),e.jsx("button",{onClick:()=>t(-1),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Go Back"})]})});const g=Array.isArray(n.image)?n.image:[n.image],D=b.getReviews().filter(h=>h.partnerId===n.id&&h.approved);return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("header",{className:"relative",children:[e.jsx("button",{onClick:()=>t(-1),className:"absolute top-4 left-4 z-10 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center shadow-lg",children:e.jsx(Bs,{className:"w-5 h-5"})}),g.length>0&&e.jsx($,{src:g[a],alt:n.name,className:"w-full h-64 object-cover"}),g.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:g.map((h,w)=>e.jsx("button",{onClick:()=>o(w),className:`w-2 h-2 rounded-full ${a===w?"bg-white":"bg-white/50"}`},w))})]}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 -mt-8 relative z-10",children:[e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-card",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:n.name==="DMK Flavor Dash"?"Food Delivery":n.name==="DMK Sip Central"?"Beverages":n.name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:n.description}),n.category!=="restaurant"&&n.category!=="beverage"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-primary fill-primary"}),e.jsx("span",{className:"font-medium",children:n.rating}),e.jsxs("span",{className:"text-muted-foreground",children:["(",D.length," reviews)"]})]})]}),n.category==="accommodation"&&e.jsxs("div",{className:"space-y-4 mt-6",children:[g.length>1&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.slice(0,4).map((h,w)=>e.jsx($,{src:h,alt:`${n.name} ${w+1}`,className:"w-full h-32 object-cover rounded-xl",onClick:()=>o(w)},w))}),e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:n.bedrooms||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-semibold",children:n.guests||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Location"}),e.jsx("p",{className:"font-semibold text-sm",children:n.location})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsxs("p",{className:"font-semibold",children:["KES ",((K=n.pricePerNight)==null?void 0:K.toLocaleString())||"N/A","/night"]})]})]})]}),n.features&&n.features.length>0&&e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Features"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.features.map((h,w)=>{const T=y(h);return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:h})]},w)})})]}),n.amenities&&n.amenities.length>0&&e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Amenities"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.amenities.map((h,w)=>{const T=N(h);return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:h})]},w)})})]}),e.jsxs(k,{onClick:()=>S(n.phone,"business_page"),className:"w-full bg-primary hover:bg-primary/90 text-white text-lg py-6",children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Book Now"]})]}),n.category==="activities"&&e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Activity Type"}),e.jsx("p",{className:"font-semibold",children:n.activityType||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Capacity"}),e.jsxs("p",{className:"font-semibold",children:[n.numberOfPAX||"N/A"," PAX"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Location"}),e.jsx("p",{className:"font-semibold text-sm",children:n.location})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsxs("p",{className:"font-semibold",children:["KES ",((A=n.pricePerPerson)==null?void 0:A.toLocaleString())||"N/A","/person"]})]})]})]}),e.jsxs(k,{onClick:()=>S(n.phone,"business_page"),className:"w-full bg-primary hover:bg-primary/90 text-white text-lg py-6",children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Book Now"]})]}),(n.category==="restaurant"||n.category==="beverage")&&e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(E,{type:"text",placeholder:"Search menu items...",value:r,onChange:h=>l(h.target.value),className:"pl-10 bg-card border-border/50"})]}),j.length>0?e.jsx(ue.div,{className:"space-y-4",initial:"hidden",animate:"show",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},children:j.map(h=>e.jsxs(ue.div,{variants:{hidden:{opacity:0,x:-20},show:{opacity:1,x:0}},className:"bg-card rounded-xl overflow-hidden shadow-sm border border-border/50 flex",children:[e.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 flex-shrink-0",children:h.image?e.jsx($,{src:h.image,alt:h.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted/30 flex items-center justify-center",children:e.jsx(we,{className:"w-8 h-8 text-muted-foreground/30"})})}),e.jsxs("div",{className:"p-3 flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-semibold text-base line-clamp-1",children:h.name}),e.jsxs("span",{className:"font-bold text-primary text-sm whitespace-nowrap ml-2",children:["KES ",h.price.toLocaleString()]})]}),h.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:h.description})]})]},h.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsxs("p",{children:['No menu items found matching "',r,'"']})}),e.jsxs(k,{onClick:()=>S(n.phone,"business_page"),className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 text-white text-lg py-6 shadow-lg shadow-primary/20 rounded-xl transition-all duration-300 transform hover:scale-[1.02]",children:[e.jsx(z,{className:"w-5 h-5 mr-2 animate-pulse"}),"Call to Order"]})]}),d.length>0&&e.jsxs("section",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Similar Partners"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:d.map(h=>e.jsxs(L,{to:`/business/${h.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx($,{src:Array.isArray(h.image)?h.image[0]:h.image,alt:h.name,className:"w-full h-32 object-cover"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:h.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:h.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",h.rating]})]})]},h.id))})]})]}),e.jsx(_,{})]})}function Jt(){const s=F(),[t,a]=c.useState([]),[o,r]=c.useState("CBD"),[l,d]=c.useState([]),[m,n]=c.useState(!1),p=b.getCurrentUser();c.useEffect(()=>{const g=()=>{a(b.getCart());const A=b.getOrders().filter(h=>h.userId===(p==null?void 0:p.id));d(A.sort((h,w)=>new Date(w.timestamp).getTime()-new Date(h.timestamp).getTime()))};g();const D=setInterval(g,2e3);return()=>clearInterval(D)},[p]);const f=(g,D)=>{const K=t.map(A=>{if(A.menuItem.id===g){const h=Math.max(1,A.quantity+D);return{...A,quantity:h}}return A});a(K),b.saveCart(K)},i=g=>{const D=t.filter(K=>K.menuItem.id!==g);a(D),b.saveCart(D),O.success("Item removed from cart")},j={CBD:70,Mukima:100,Baraka:150,Mugambi:120,Katheri:200,MKWE:200,Likii:70,Makutano:100,Airstrip:250},u=t.reduce((g,D)=>g+D.menuItem.price*D.quantity,0),C=j[o]||70,x=u+C,S=()=>{if(t.length===0){O.error("Your cart is empty");return}if(!p){O.error("Please login to continue with your order"),s("/login",{state:{returnTo:"/cart"}});return}s("/checkout")},y=g=>({placed:"bg-info text-info-foreground",confirming:"bg-warning text-warning-foreground",preparing:"bg-primary text-primary-foreground",dispatched:"bg-accent text-accent-foreground",nearby:"bg-success text-success-foreground",delivered:"bg-success text-success-foreground"})[g]||"bg-muted text-muted-foreground",N=g=>({placed:"Placed",confirming:"Confirming",preparing:"Preparing",dispatched:"On the Way",nearby:"Nearby",delivered:"Delivered"})[g];return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6",children:[e.jsx(ve,{className:"mb-6"}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"My Orders"}),l.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ye,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No orders yet"}),e.jsx(L,{to:"/home",className:"inline-block px-6 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90",children:"Start Shopping"})]}):e.jsx("div",{className:"space-y-4",children:l.map(g=>e.jsxs(L,{to:`/order-tracking/${g.id}`,className:"block bg-card rounded-xl p-4 shadow-card hover:shadow-hover transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["Order #",g.id]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(g.timestamp).toLocaleDateString()," at"," ",new Date(g.timestamp).toLocaleTimeString()]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${y(g.status)}`,children:N(g.status)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[g.items.length," items"]}),e.jsxs("p",{className:"font-semibold text-primary",children:["KES ",g.total]})]}),e.jsx(Je,{className:"w-5 h-5 text-muted-foreground"})]})]},g.id))})]}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),e.jsx(L,{to:"/home",children:e.jsx(k,{className:"bg-primary hover:bg-primary/90",children:"Start Shopping"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 mb-6",children:t.map(g=>e.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:g.menuItem.image,alt:g.menuItem.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:g.menuItem.name}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["KES ",g.menuItem.price]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-muted rounded-lg",children:[e.jsx("button",{onClick:()=>f(g.menuItem.id,-1),className:"p-2 hover:bg-muted-foreground/10 rounded-lg",children:e.jsx(Hs,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium w-8 text-center",children:g.quantity}),e.jsx("button",{onClick:()=>f(g.menuItem.id,1),className:"p-2 hover:bg-muted-foreground/10 rounded-lg",children:e.jsx(Gs,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>i(g.menuItem.id),className:"ml-auto text-destructive hover:bg-destructive/10 p-2 rounded-lg",children:e.jsx(Ys,{className:"w-4 h-4"})})]})]})]})},g.menuItem.id))}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Delivery Location"}),e.jsxs(W,{value:o,onValueChange:r,children:[e.jsx(Q,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(v,{value:"CBD",children:"CBD"}),e.jsx(v,{value:"Mukima",children:"Mukima"}),e.jsx(v,{value:"Baraka",children:"Baraka"}),e.jsx(v,{value:"Mugambi",children:"Mugambi"}),e.jsx(v,{value:"Katheri",children:"Katheri"}),e.jsx(v,{value:"MKWE",children:"MKWE"}),e.jsx(v,{value:"Likii",children:"Likii"}),e.jsx(v,{value:"Makutano",children:"Makutano"}),e.jsx(v,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["KES ",u]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{className:"font-medium",children:["KES ",C]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-border",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",x]})]})]}),e.jsx(L,{to:"/home",className:"block",children:e.jsxs(k,{variant:"outline",className:"w-full h-12 mb-3 flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Continue Shopping"]})}),e.jsxs(k,{onClick:S,className:"w-full bg-primary hover:bg-primary/90 h-12",children:["Checkout - KES ",x]})]})]})]}),e.jsx(_,{})]})}const Ns=c.forwardRef(({className:s,...t},a)=>e.jsx(Xe,{className:P("grid gap-2",s),...t,ref:a}));Ns.displayName=Xe.displayName;const he=c.forwardRef(({className:s,...t},a)=>e.jsx(Ze,{ref:a,className:P("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Js,{className:"flex items-center justify-center",children:e.jsx(Xs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));he.displayName=Ze.displayName;function Xt({open:s,onOpenChange:t,partnerName:a,onRate:o}){const[r,l]=c.useState(0),[d,m]=c.useState(""),n=()=>{r>0&&(o(r,d),l(0),m(""),t(!1))},p=j=>j<r?e.jsx(ne,{className:"w-8 h-8 text-yellow-500 fill-yellow-500"}):e.jsx(ne,{className:"w-8 h-8 text-gray-300"}),f=()=>{switch(r){case 1:return"Poor experience";case 2:return"Below average";case 3:return"Average";case 4:return"Good experience";case 5:return"Excellent!";default:return"How was your experience?"}},i=()=>{switch(r){case 1:return"😞";case 2:return"😐";case 3:return"🙂";case 4:return"😊";case 5:return"🤩";default:return"⭐"}};return e.jsx(ts,{open:s,onOpenChange:t,children:e.jsxs(as,{className:"max-w-md",children:[e.jsx(rs,{children:e.jsx(ns,{className:"text-center",children:"Rate Your Experience"})}),e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"How was your order experience?"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(j=>e.jsx("button",{onClick:()=>l(j),className:"transition-transform hover:scale-110",children:p(j)},j))}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:i()}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:f()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Leave a comment (optional)"}),e.jsx(is,{value:d,onChange:j=>m(j.target.value),placeholder:"Tell us about your experience...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:n,disabled:r===0,className:"flex-1 bg-primary hover:bg-primary/90",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Submit Rating"]}),e.jsx(k,{variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"Skip"})]})]})]})})}function Zt(){const s=F(),t=b.getCurrentUser(),a=b.getCart(),[o,r]=c.useState("MPESA"),[l,d]=c.useState((t==null?void 0:t.location)||"CBD"),[m,n]=c.useState((t==null?void 0:t.fullName)||""),[p,f]=c.useState((t==null?void 0:t.phone)||""),[i,j]=c.useState(!1),[u,C]=c.useState(null),x={CBD:70,Mukima:100,Baraka:150,Mugambi:120,Katheri:200,MKWE:200,Likii:70,Makutano:100,Airstrip:250},S=a.reduce((A,h)=>A+h.menuItem.price*h.quantity,0),y=x[l]||70,N=S+y,g=A=>{var T,ye;A.preventDefault();const h=b.getOrders(),w={id:`ORD${Date.now()}`,userId:(t==null?void 0:t.id)||"guest",partnerId:((T=a[0])==null?void 0:T.menuItem.partnerId)||"",partnerName:D(((ye=a[0])==null?void 0:ye.menuItem.partnerId)||""),items:[...a],total:N,deliveryFee:y,deliveryLocation:l,paymentMethod:o,status:"placed",timestamp:new Date().toISOString(),customerName:m,customerPhone:p};h.push(w),b.saveOrders(h),b.saveCart([]),C(w),j(!0),O.success("Order placed successfully!")},D=A=>{var w;return((w=b.getPartners().find(T=>T.id===A))==null?void 0:w.name)||"Unknown Partner"},K=(A,h)=>{if(u){const w=b.getReviews(),T={id:`REV${Date.now()}`,userId:(t==null?void 0:t.id)||"guest",userName:(t==null?void 0:t.fullName)||"Guest",partnerId:u.partnerId,orderId:u.id,rating:A,comment:h,approved:!1,createdAt:new Date().toISOString()};w.push(T),b.saveReviews(w),O.success("Thank you for your feedback!")}s(`/order-tracking/${u==null?void 0:u.id}`)};return e.jsxs("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:[e.jsx(R,{}),e.jsx("div",{className:"max-w-lg mx-auto px-4 py-6",children:e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Delivery Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"name",children:"Full Name"}),e.jsx(E,{id:"name",value:m,onChange:A=>n(A.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"phone",children:"Phone Number"}),e.jsx(E,{id:"phone",type:"tel",value:p,onChange:A=>f(A.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"location",children:"Delivery Location"}),e.jsxs(W,{value:l,onValueChange:d,required:!0,children:[e.jsx(Q,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(v,{value:"CBD",children:"CBD"}),e.jsx(v,{value:"Mukima",children:"Mukima"}),e.jsx(v,{value:"Baraka",children:"Baraka"}),e.jsx(v,{value:"Mugambi",children:"Mugambi"}),e.jsx(v,{value:"Katheri",children:"Katheri"}),e.jsx(v,{value:"MKWE",children:"MKWE"}),e.jsx(v,{value:"Likii",children:"Likii"}),e.jsx(v,{value:"Makutano",children:"Makutano"}),e.jsx(v,{value:"Airstrip",children:"Airstrip"})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Payment Method"}),e.jsxs(Ns,{value:o,onValueChange:r,children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 border border-border rounded-lg cursor-pointer hover:bg-muted",children:[e.jsx(he,{value:"MPESA",id:"mpesa"}),e.jsxs(I,{htmlFor:"mpesa",className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:"MPESA"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay via MPESA mobile money"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 border border-border rounded-lg cursor-pointer hover:bg-muted",children:[e.jsx(he,{value:"Card",id:"card"}),e.jsxs(I,{htmlFor:"card",className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:"Card Payment"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay with debit/credit card"})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["KES ",S]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{children:["KES ",y]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-3 border-t border-border",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",N]})]})]})]}),e.jsxs(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 h-12 text-lg",children:["Place Order - KES ",N]})]})}),e.jsx(Xt,{open:i,onOpenChange:j,partnerName:(u==null?void 0:u.partnerName)||"",onRate:K})]})}function ea({locations:s,selectedLocation:t,onLocationSelect:a,showRiderTracking:o=!1,riderLocation:r,estimatedDelivery:l}){const[d]=c.useState({lat:-.02,lng:37.0739}),[m,n]=c.useState(null),p=f=>{n(f),a(f)};return e.jsxs("div",{className:"w-full h-96 bg-gradient-to-br from-blue-50 to-green-50 rounded-xl border-2 border-blue-200 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-400/20 to-blue-400/20",children:e.jsx("div",{className:"absolute inset-0 opacity-30"})}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs font-medium text-gray-700 bg-white px-2 py-1 rounded shadow",children:"Nanyuki Center"})]}),s.map((f,i)=>{const j=50+(f.coordinates.lng-d.lng)*1e3,u=50+(f.coordinates.lat-d.lat)*1e3;return e.jsxs("div",{className:"absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2",style:{left:`${Math.max(10,Math.min(90,j))}%`,top:`${Math.max(10,Math.min(90,u))}%`},onClick:()=>p(f),children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 border-white shadow-lg flex items-center justify-center transition-all duration-200 ${t===f.id?"bg-primary scale-110":"bg-blue-500 hover:bg-blue-600"}`,children:e.jsx(X,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:`absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs font-medium bg-white px-2 py-1 rounded shadow whitespace-nowrap ${t===f.id?"text-primary":"text-gray-700"}`,children:f.name})]},f.id)}),o&&r&&e.jsxs("div",{className:"absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2 animate-pulse",style:{left:`${50+(r.lng-d.lng)*1e3}%`,top:`${50+(r.lat-d.lat)*1e3}%`},children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs font-medium bg-orange-100 text-orange-800 px-2 py-1 rounded shadow",children:"Rider"})]}),e.jsx("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:e.jsx(k,{size:"sm",variant:"secondary",className:"bg-white/90 backdrop-blur-sm",children:e.jsx(xe,{className:"w-4 h-4"})})}),m&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx(ee,{className:"bg-white/95 backdrop-blur-sm",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:m.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Delivery Fee: KES ",m.fee]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(es,{className:"w-4 h-4"}),e.jsx("span",{children:l})]})]})})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur-sm px-3 py-2 rounded-lg shadow",children:e.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Service Area: 15km radius"})})]})}const me=s=>({CBD:{lat:-.02,lng:37.0739},Mukima:{lat:-.025,lng:37.08},Baraka:{lat:-.015,lng:37.06},Mugambi:{lat:-.03,lng:37.07},Katheri:{lat:-.01,lng:37.09},MKWE:{lat:-.035,lng:37.055},Likii:{lat:-.02,lng:37.065},Makutano:{lat:-.025,lng:37.075},Airstrip:{lat:-.018,lng:37.078}})[s]||{lat:-.02,lng:37.0739};function sa({orderId:s,customerLocation:t,estimatedDelivery:a}){const[o,r]=c.useState(null),[l,d]=c.useState("picked_up");c.useEffect(()=>{const p={id:"rider1",name:"John Kamau",phone:"+254720123456",location:me("CBD"),status:"picked_up"};r(p);const f=setInterval(()=>{r(i=>{if(!i)return null;const j=me(t),u=i.location,C=u.lat+(j.lat-u.lat)*.1,x=u.lng+(j.lng-u.lng)*.1,S=C-j.lat,y=x-j.lng,N=Math.sqrt(S*S+y*y);let g=i.status;return N<.005?g="arrived":N<.01?g="nearby":N<.02&&(g="on_the_way"),d(g),{...i,location:{lat:C,lng:x},status:g}})},3e3);return()=>clearInterval(f)},[t]);const m=p=>{switch(p){case"picked_up":return"Your order has been picked up and is on the way!";case"on_the_way":return"Your rider is on the way to your location";case"nearby":return"Your rider is nearby and will arrive shortly";case"arrived":return"Your rider has arrived at your location";default:return"Tracking your order..."}},n=p=>{switch(p){case"picked_up":return"text-blue-600 bg-blue-100";case"on_the_way":return"text-yellow-600 bg-yellow-100";case"nearby":return"text-orange-600 bg-orange-100";case"arrived":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ee,{className:"shadow-lg",children:[e.jsx(le,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-primary"}),"Order Tracking - #",s]})}),e.jsxs(se,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${n(l)}`,children:l.replace("_"," ").toUpperCase()}),e.jsx(es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m(l)}),e.jsxs("div",{className:"flex items-center gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:o.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery Partner"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Call"]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Message"]})]})]})]})]}),e.jsxs(ee,{className:"shadow-lg",children:[e.jsx(le,{children:e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary"}),"Live Tracking"]})}),e.jsx(se,{children:e.jsx(ea,{locations:[{id:t,name:t,fee:0,coordinates:me(t)}],selectedLocation:t,onLocationSelect:()=>{},showRiderTracking:!0,riderLocation:o.location,estimatedDelivery:a})})]}),e.jsxs(ee,{className:"shadow-lg",children:[e.jsx(le,{children:e.jsx(oe,{children:"Delivery Instructions"})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"• Please ensure someone is available to receive the order"}),e.jsx("p",{children:"• Have your payment ready if paying on delivery"}),e.jsx("p",{children:"• Contact the rider directly if you need to provide additional directions"}),e.jsxs("p",{children:["• Your order will be delivered to: ",e.jsx("strong",{children:t})]})]})})]})]}):e.jsx("div",{className:"w-full h-64 bg-muted rounded-xl flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading rider information..."})})}function ta(){const{id:s}=je(),t=F(),[a,o]=c.useState(null);if(c.useEffect(()=>{const d=()=>{const p=b.getOrders().find(f=>f.id===s);p&&o(p)};d();const m=setInterval(d,2e3);return()=>clearInterval(m)},[s]),!a)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{children:"Order not found"})});const r=[{status:"placed",label:"Placed",icon:Ye,color:"bg-blue-500"},{status:"preparing",label:"Preparing",icon:ge,color:"bg-yellow-500"},{status:"dispatched",label:"On the Way",icon:tt,color:"bg-orange-500"},{status:"delivered",label:"Delivered",icon:at,color:"bg-green-500"}],l=r.findIndex(d=>d.status===a.status);return e.jsxs("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card mb-6",children:[e.jsx("div",{className:"flex justify-between mb-8",children:r.map((d,m)=>{const n=m<=l,p=d.icon;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-2 transition-colors ${n?`${d.color} text-white`:"bg-gray-300 text-gray-500"}`,children:e.jsx(p,{className:"w-6 h-6"})}),e.jsx("span",{className:`text-xs font-medium text-center ${n?"text-gray-800":"text-gray-500"}`,children:d.label}),m<r.length-1&&e.jsx("div",{className:`absolute h-0.5 w-1/4 top-6 ${n?"bg-primary":"bg-muted"}`,style:{left:`${(m+.5)*25}%`}})]},d.status)})}),a.status!=="delivered"&&e.jsxs("div",{className:"bg-muted rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Estimated delivery"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:"30-45 minutes"})]})]}),(a.status==="dispatched"||a.status==="nearby")&&e.jsx("div",{className:"mb-6",children:e.jsx(sa,{orderId:a.id,customerLocation:a.deliveryLocation,estimatedDelivery:"15-20 minutes"})}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Order Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order ID"}),e.jsx("span",{className:"font-medium",children:a.id})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date & Time"}),e.jsxs("span",{className:"font-medium",children:[new Date(a.timestamp).toLocaleDateString()," at"," ",new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Location"}),e.jsx("span",{className:"font-medium",children:a.deliveryLocation})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Method"}),e.jsx("span",{className:"font-medium",children:a.paymentMethod})]}),e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["KES ",a.total-a.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{children:["KES ",a.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",a.total]})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card mt-6",children:[e.jsxs("h2",{className:"font-semibold text-lg mb-4",children:["Items (",a.items.length,")"]}),e.jsx("div",{className:"space-y-3",children:a.items.map((d,m)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[d.quantity,"x ",d.menuItem.name]}),e.jsxs("span",{className:"font-medium",children:["KES ",d.menuItem.price*d.quantity]})]},m))})]}),e.jsxs(k,{onClick:()=>t("/cart"),className:"w-full mt-6 bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center gap-2 h-12 font-medium",children:[e.jsx(st,{className:"w-5 h-5"}),"Back to Orders"]})]})]})}function aa({open:s,onOpenChange:t,user:a,onSave:o}){const[r,l]=c.useState({id:"",username:"",password:"",fullName:"",phone:"",location:"",role:"user",profileImage:""});c.useEffect(()=>{a&&l(a)},[a,s]);const d=m=>{m.preventDefault(),o(r),t(!1)};return e.jsx(ts,{open:s,onOpenChange:t,children:e.jsxs(as,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(rs,{children:e.jsx(ns,{children:"Edit Profile"})}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{htmlFor:"profileImage",className:"text-base font-medium",children:"Profile Image"}),e.jsx("div",{className:"w-full",children:e.jsx(yt,{value:r.profileImage||"",onChange:m=>l({...r,profileImage:m}),placeholder:"Choose Profile Image",className:"w-full h-32 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors"})})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"fullName",children:"Full Name"}),e.jsx(E,{id:"fullName",value:r.fullName,onChange:m=>l({...r,fullName:m.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"username",children:"Username"}),e.jsx(E,{id:"username",value:r.username,onChange:m=>l({...r,username:m.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"phone",children:"Phone"}),e.jsx(E,{id:"phone",value:r.phone,onChange:m=>l({...r,phone:m.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"location",children:"Default Location"}),e.jsxs(W,{value:r.location,onValueChange:m=>l({...r,location:m}),children:[e.jsx(Q,{children:e.jsx(H,{})}),e.jsxs(G,{children:[e.jsx(v,{value:"CBD",children:"CBD"}),e.jsx(v,{value:"Mukima",children:"Mukima"}),e.jsx(v,{value:"Baraka",children:"Baraka"}),e.jsx(v,{value:"Mugambi",children:"Mugambi"}),e.jsx(v,{value:"Katheri",children:"Katheri"}),e.jsx(v,{value:"MKWE",children:"MKWE"}),e.jsx(v,{value:"Likii",children:"Likii"}),e.jsx(v,{value:"Makutano",children:"Makutano"}),e.jsx(v,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"password",children:"New Password (Optional)"}),e.jsx(E,{id:"password",type:"password",value:r.password,onChange:m=>l({...r,password:m.target.value}),placeholder:"Leave blank to keep current password"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{type:"submit",className:"flex-1",children:"Save Changes"}),e.jsx(k,{type:"button",variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"Cancel"})]})]})]})})}function ra(){const s=F(),t=b.getCurrentUser(),[a,o]=c.useState(!1),r=()=>{b.setCurrentUser(null),window.dispatchEvent(new CustomEvent("userLogout")),O.success("Logged out successfully"),s("/home")},l=d=>{const n=b.getUsers().map(p=>p.id===d.id?d:p);b.saveUsers(n),b.setCurrentUser(d),O.success("Profile updated successfully")};return t?e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsx("header",{className:"bg-gradient-hero text-white",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-full mx-auto mb-4 flex items-center justify-center overflow-hidden",children:t.profileImage?e.jsx("img",{src:t.profileImage,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(Se,{className:"w-10 h-10 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:t.fullName}),e.jsxs("p",{className:"text-white/90",children:["@",t.username]}),e.jsxs(k,{onClick:()=>o(!0),variant:"outline",size:"sm",className:"mt-4 bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Account Information"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"font-medium",children:t.fullName})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Default Location"}),e.jsx("p",{className:"font-medium",children:t.location})]})]})]}),t.role==="admin"&&e.jsxs("button",{onClick:()=>s("/admin"),className:"w-full bg-card rounded-xl p-4 shadow-card hover:shadow-hover transition-shadow flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Admin Panel"}),e.jsx(Je,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs(k,{onClick:r,variant:"destructive",className:"w-full h-12 text-base",children:[e.jsx(nt,{className:"w-5 h-5 mr-2"}),"Logout"]}),e.jsx("div",{className:"text-center pt-4",children:e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-16 w-auto mx-auto mb-2 opacity-50 object-contain"})})]}),e.jsx(aa,{open:a,onOpenChange:o,user:t,onSave:l}),e.jsx(_,{})]}):(s("/login"),null)}function na({show:s=!1}){return s?e.jsxs("div",{className:"text-center py-8 mb-4 text-xs text-muted-foreground border-t border-zinc-100 dark:border-zinc-800 mx-4",children:["Developed by"," ",e.jsx("a",{href:"https://vairal.co.ke",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:"Vairal Media"})]}):null}function ia(){const[s,t]=c.useState({name:"",organizationType:"",location:"",phone:"",message:""}),a=r=>{r.preventDefault();const l=`
*New Business Inquiry - Discover Mount Kenya*

*Name:* ${s.name}
*Organization Type:* ${s.organizationType}
*Location:* ${s.location}
*Phone:* ${s.phone}

*Message:*
${s.message}

---
_This inquiry was submitted through the Discover Mount Kenya app._
    `.trim(),d=`https://wa.me/254756253477?text=${encodeURIComponent(l)}`;window.open(d,"_blank"),t({name:"",organizationType:"",location:"",phone:"",message:""}),O.success("WhatsApp opened. Please send your inquiry.")},o=()=>{window.location.href="tel:+254711672672"};return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary rounded-xl flex items-center justify-center",children:e.jsx(Ve,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Discover Mount Kenya"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mount Kenya's Premier Destination"})]})]}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-300 leading-relaxed text-sm mt-2",children:"Mount Kenya is not meant to be discovered randomly. Most visitors experience fragments. Good places hidden behind poor discovery. Exceptional service buried under noise. Quality diluted by volume."}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-300 leading-relaxed text-sm mt-3",children:"Discover Mount Kenya exists to change that. This is a private concierge, built for travellers and residents who value taste, trust, and discretion. Every stay, wellness service, activity, meal, and gift is selected with intent. Partners are vetted. Standards are non-negotiable."}),e.jsxs(k,{onClick:o,className:"w-full bg-primary hover:bg-primary/90 text-white mt-4",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Contact Us"]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-primary rounded-xl flex items-center justify-center",children:e.jsx(it,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Partner With Us"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Feature your Business"})]})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"name",className:"text-sm",children:"Your Name *"}),e.jsx(E,{id:"name",value:s.name,onChange:r=>t({...s,name:r.target.value}),required:!0,placeholder:"Enter your full name",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"organizationType",className:"text-sm",children:"Type of Organization *"}),e.jsxs(W,{value:s.organizationType,onValueChange:r=>t({...s,organizationType:r}),children:[e.jsx(Q,{className:"text-sm",children:e.jsx(H,{placeholder:"Select organization type"})}),e.jsxs(G,{children:[e.jsx(v,{value:"Accommodation",children:"Accommodation"}),e.jsx(v,{value:"Restaurant",children:"Restaurant"}),e.jsx(v,{value:"Beverage Outlet",children:"Beverage Outlet"}),e.jsx(v,{value:"Activities",children:"Activities"}),e.jsx(v,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"location",className:"text-sm",children:"County *"}),e.jsxs(W,{value:s.location,onValueChange:r=>t({...s,location:r}),children:[e.jsx(Q,{className:"text-sm",children:e.jsx(H,{placeholder:"Select county"})}),e.jsxs(G,{children:[e.jsx(v,{value:"Nyeri County",children:"Nyeri County"}),e.jsx(v,{value:"Laikipia County",children:"Laikipia County"}),e.jsx(v,{value:"Meru County",children:"Meru County"}),e.jsx(v,{value:"Isiolo County",children:"Isiolo County"}),e.jsx(v,{value:"Kirinyaga County",children:"Kirinyaga County"}),e.jsx(v,{value:"Embu County",children:"Embu County"})]})]})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"phone",className:"text-sm",children:"Contact Phone *"}),e.jsx(E,{id:"phone",type:"tel",value:s.phone,onChange:r=>t({...s,phone:r.target.value}),required:!0,placeholder:"Enter your phone number",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"message",className:"text-sm",children:"Additional Details"}),e.jsx(is,{id:"message",value:s.message,onChange:r=>t({...s,message:r.target.value}),placeholder:"Tell us more about your business and partnership interests...",rows:4,className:"text-sm"})]}),e.jsxs(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-white",children:[e.jsx(lt,{className:"w-4 h-4 mr-2"}),"Send Inquiry"]})]})]})]}),e.jsx(na,{show:!0}),e.jsx(_,{})]})}const la=()=>{const s=Y();return c.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},oa=()=>{const[s,t]=c.useState(null),[a,o]=c.useState(!1),[r,l]=c.useState(!1);return c.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches?(l(!0),!0):!1)return;const n=()=>{"serviceWorker"in navigator&&document.querySelector('link[rel="manifest"]')&&o(!0)},p=i=>{i.preventDefault(),t(i),o(!0)},f=()=>{l(!0),o(!1),t(null)};return n(),window.addEventListener("beforeinstallprompt",p),window.addEventListener("appinstalled",f),()=>{window.removeEventListener("beforeinstallprompt",p),window.removeEventListener("appinstalled",f)}},[]),{isInstallable:a,isInstalled:r,installApp:async()=>{if(s)try{await s.prompt();const{outcome:m}=await s.userChoice;if(m==="accepted")return l(!0),o(!1),t(null),!0}catch(m){console.error("Error installing PWA:",m)}else try{if("serviceWorker"in navigator&&"PushManager"in window){const m=await navigator.serviceWorker.getRegistration();m&&await m.update()}}catch(m){console.error("Error with installation:",m)}return!1}}};function ca(){const{isInstallable:s,isInstalled:t,installApp:a}=oa(),o=Y(),[r,l]=c.useState(!1);if(c.useEffect(()=>{l(!1)},[o.pathname]),o.pathname.includes("admin")||o.pathname.includes("dmk-login-admin"))return null;const d=async()=>{await a()&&O.success("App installed successfully!")},m=()=>{l(!0)};return!s||t||r?null:e.jsx("div",{id:"pwa-install-prompt",className:"fixed bottom-20 left-4 right-4 z-50 animate-in slide-in-from-bottom-5 duration-500",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-md dark:bg-slate-900/95 border border-primary/20 shadow-xl rounded-2xl p-6 text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto",children:e.jsx(ot,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"Download for Offline Access"}),e.jsx("p",{className:"text-sm text-primary font-bold italic leading-relaxed px-2",children:'"Crafted experiences. Trusted places."'}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed px-2 pt-1 border-t border-primary/5",children:"Add to home screen for a fast, native app experience that works anywhere, even without internet."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsxs(k,{onClick:d,className:"flex-1 bg-primary hover:bg-primary/90 text-white shadow-lg h-10",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Install Now"]}),e.jsxs(k,{onClick:m,className:"flex-1 text-white shadow-sm h-10 border-0",style:{backgroundColor:"#800020"},children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"Not Now"]})]})]})})}function da(s={}){const{immediate:t=!1,onNeedRefresh:a,onOfflineReady:o,onRegistered:r,onRegisteredSW:l,onRegisterError:d}=s;let m,n;const p=async(i=!0)=>{await n};async function f(){if("serviceWorker"in navigator){if(m=await It(async()=>{const{Workbox:i}=await import("./vendor-react-BNFt8q1m.js").then(j=>j.bv);return{Workbox:i}},__vite__mapDeps([0,1])).then(({Workbox:i})=>new i("/discovermtkenya/sw.js",{scope:"/discovermtkenya/",type:"classic"})).catch(i=>{d==null||d(i)}),!m)return;m.addEventListener("activated",i=>{(i.isUpdate||i.isExternal)&&window.location.reload()}),m.addEventListener("installed",i=>{i.isUpdate||o==null||o()}),m.register({immediate:t}).then(i=>{l?l("/discovermtkenya/sw.js",i):r==null||r(i)}).catch(i=>{d==null||d(i)})}}return n=f(),p}const ws=()=>{if("serviceWorker"in navigator){const s=da({onNeedRefresh(){confirm("New content available. Reload to update?")&&s(!0)},onOfflineReady(){console.log("App is ready for offline use")}})}};function ma(){const{pathname:s}=Y();return c.useEffect(()=>{window.scrollTo(0,0)},[s]),null}const B=new dt({defaultOptions:{queries:{staleTime:1e3*60*60*24,gcTime:1e3*60*60*24*7,retry:3,retryDelay:s=>Math.min(1e3*2**s,1e4),refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchOnMount:!1},mutations:{retry:1,retryDelay:1e3}}}),ua=xt({storage:{getItem:s=>localStorage.getItem(s),setItem:(s,t)=>{localStorage.setItem(s,t)},removeItem:s=>{localStorage.removeItem(s)}}}),xa=()=>{const s=Y();return e.jsx(Ke,{mode:"wait",children:e.jsxs(ht,{location:s,children:[e.jsx(M,{path:"/",element:e.jsx(pt,{to:"/splash",replace:!0})}),e.jsx(M,{path:"/splash",element:e.jsx(zt,{})}),e.jsx(M,{path:"/login",element:e.jsx(Ie,{})}),e.jsx(M,{path:"/dmk-login-admin",element:e.jsx(Ie,{})}),e.jsx(M,{path:"/create-account",element:e.jsx(_t,{})}),e.jsx(M,{path:"/home",element:e.jsx(Wt,{})}),e.jsx(M,{path:"/categories",element:e.jsx(Qt,{})}),e.jsx(M,{path:"/category/:category",element:e.jsx(Ht,{})}),e.jsx(M,{path:"/business/:id",element:e.jsx(Yt,{})}),e.jsx(M,{path:"/cart",element:e.jsx(Jt,{})}),e.jsx(M,{path:"/checkout",element:e.jsx(Zt,{})}),e.jsx(M,{path:"/order-tracking/:id",element:e.jsx(ta,{})}),e.jsx(M,{path:"/profile",element:e.jsx(ra,{})}),e.jsx(M,{path:"/settings",element:e.jsx(ia,{})}),e.jsx(M,{path:"/admin",element:e.jsx(bt,{})}),e.jsx(M,{path:"/admin/partners",element:e.jsx(Nt,{})}),e.jsx(M,{path:"/admin/menus",element:e.jsx(wt,{})}),e.jsx(M,{path:"/admin/users",element:e.jsx(Ct,{})}),e.jsx(M,{path:"/admin/reviews",element:e.jsx(St,{})}),e.jsx(M,{path:"/admin/analytics",element:e.jsx(kt,{})}),e.jsx(M,{path:"*",element:e.jsx(la,{})})]},s.pathname)})},ha=()=>{const[s,t]=c.useState({progress:0,status:"Initializing...",isComplete:!1,isVisible:!1});return c.useEffect(()=>{ws(),(async()=>{try{const l=await fetch("https://raw.githubusercontent.com/Vairal77/discovermtkenya/main/public/version.json");if(l.ok){const d=await l.json(),m=localStorage.getItem("dmk_app_version");m&&m!==d.version?(console.log("DMK: New version detected, updating assets..."),localStorage.setItem("dmk_app_version",d.version)):m||localStorage.setItem("dmk_app_version",d.version)}}catch{console.log("DMK: Update check failed (offline or GitHub unreachable)")}})();const r=setTimeout(async()=>{if(console.log("DMK: Starting deep EXHAUSTIVE cache warming..."),!sessionStorage.getItem("dmk_sync_complete")){t(l=>({...l,isVisible:!0,status:"Connecting to server..."}));try{const l="https://vwhgnzioqrhjgvxffuyq.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ3aGduemlvcXJoamd2eGZmdXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNzg2NzksImV4cCI6MjA3Njk1NDY3OX0.IukGQw9fwHFKWNsmhea-5z4fCOZ8S4b6G3QET1JrHSU",m={apikey:d,Authorization:`Bearer ${d}`,"Content-Type":"application/json"};t(x=>({...x,progress:10,status:"Downloading Partner database..."}));const n=await fetch(`${l}/rest/v1/partners?select=*`,{headers:m}).then(x=>x.json());if(!Array.isArray(n))throw new Error("Invalid partners data");B.setQueryData(["partners"],n),B.setQueryData(["partners","categories"],n),B.setQueryData(["partners","promoted","home"],n.filter(x=>x.promoted)),B.setQueryData(["partners","promoted","categories"],n.filter(x=>x.promoted)),t(x=>({...x,progress:30,status:"Syncing Business Menus..."}));const p=await fetch(`${l}/rest/v1/menu_items?select=*`,{headers:m}).then(x=>x.json());if(!Array.isArray(p))throw new Error("Invalid menu items data");[...new Set(n.map(x=>x.category))].forEach(x=>{const S=n.filter(y=>y.category===x);B.setQueryData(["partners","category",x],S)}),n.forEach((x,S)=>{const y=p.filter(N=>N.partner_id===x.id);if(B.setQueryData(["partner",x.id],x),B.setQueryData(["menu",x.id],y),S%5===0){const N=30+S/n.length*20;t(g=>({...g,progress:N,status:`Processing ${x.name}...`}))}}),t(x=>({...x,progress:50,status:"Downloading offline media assets..."}));const i=new Set;n.forEach(x=>{x.image&&(Array.isArray(x.image)?x.image.forEach(S=>i.add(S)):i.add(x.image))}),p.forEach(x=>{x.image&&i.add(x.image)});const j=Array.from(i).filter(x=>x&&x.startsWith("http"));let u=0;const C=10;for(let x=0;x<j.length;x+=C){const S=j.slice(x,x+C);await Promise.all(S.map(N=>new Promise(g=>{const D=new Image;D.src=N,D.onload=g,D.onerror=g}))),u+=S.length;const y=50+u/j.length*50;t(N=>({...N,progress:y,status:`Caching image ${u} of ${j.length}...`}))}console.log(`DMK: Offline sync complete. ${i.size} images cached.`),t(x=>({...x,progress:100,status:"Offline Ready",isComplete:!0})),sessionStorage.setItem("dmk_sync_complete","true"),setTimeout(()=>{t(x=>({...x,isVisible:!1}))},3e3)}catch(l){console.error("Deep cache warmer failed:",l),t(d=>({...d,status:"Sync paused - waiting for network",isVisible:!1}))}}},2e3);return()=>clearTimeout(r)},[]),e.jsx(mt,{client:B,persistOptions:{persister:ua},onSuccess:()=>{B.resumePausedMutations()},children:e.jsxs(Bt,{children:[e.jsx(Kt,{}),e.jsx(Rt,{}),e.jsx(qt,{progress:s.progress,status:s.status,isComplete:s.isComplete,isVisible:s.isVisible}),e.jsxs(ut,{basename:"/discovermtkenya",children:[e.jsx(ma,{}),e.jsx(xa,{}),e.jsx(ca,{})]})]})})};ws();gt(document.getElementById("root")).render(e.jsx(ha,{}));
