const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-react-DKtqgGsc.js","assets/vendor-utils-D77wr3qA.js"])))=>i.map(i=>d[i]);
import{r as d,j as e,ak as De,al as Ae,am as Ie,an as Me,X as Le,ao as Pe,ap as Ee,aq as bs,ar as Ns,as as ws,at as Te,au as Cs,w as O,v as J,av as Oe,aw as V,ax as ee,x as E,u as T,ay as Ss,az as Ke,aA as Fe,aB as Be,aC as Re,aD as $e,aE as qe,aF as ks,aG as Ds,aH as As,aI as Is,aJ as Ms,aK as _e,m as he,a4 as ze,a5 as q,aL as Ls,aM as ge,aN as Ue,aO as pe,aP as Ve,aQ as fe,aR as je,a8 as We,a9 as Z,W as Ps,aS as Es,aT as Ts,B as Os,aU as ne,N as Ks,K as W,aV as be,aW as Ne,aX as Fs,J as Bs,aY as Rs,aZ as $s,a_ as we,a$ as qs,b0 as _s,b1 as zs,b2 as Qe,b3 as He,b4 as Us,a7 as Vs,ab as Ws,b5 as Ye,b6 as Ge,b7 as Qs,b8 as Hs,b9 as Ys,ba as ue,bb as Je,E as Gs,bc as Js,bd as Xs,be as Zs,af as Ce,bf as et,y as st,bg as tt,bh as at,bi as rt,bj as nt,bk as it,bl as ot,bm as lt,bn as ct,bo as dt,bp as mt,bq as ut,br as xt,bs as I,bt as ht,bu as gt}from"./vendor-react-DKtqgGsc.js";import{a as pt}from"./vendor-utils-D77wr3qA.js";import{c as L,l as ie,L as A,I as P,B as k,s as S,S as Q,a as H,b as Y,d as G,e as j,f as Xe,p as $,g as B,m as Ze,i as ft,D as es,h as ss,j as ts,k as as,T as rs,C as se,n as te,o as oe,q as le,r as jt,A as vt,t as yt,u as bt,v as Nt,w as wt,x as Ct}from"./admin-DYCk70JF.js";import{_ as St}from"./vendor-supabase-DZ2aLXR7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();const kt=1,Dt=1e6;let ce=0;function At(){return ce=(ce+1)%Number.MAX_SAFE_INTEGER,ce.toString()}const de=new Map,Se=s=>{if(de.has(s))return;const t=setTimeout(()=>{de.delete(s),X({type:"REMOVE_TOAST",toastId:s})},Dt);de.set(s,t)},It=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,kt)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?Se(a):s.toasts.forEach(l=>{Se(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},ae=[];let re={toasts:[]};function X(s){re=It(re,s),ae.forEach(t=>{t(re)})}function Mt({...s}){const t=At(),a=n=>X({type:"UPDATE_TOAST",toast:{...n,id:t}}),l=()=>X({type:"DISMISS_TOAST",toastId:t});return X({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:n=>{n||l()}}}),{id:t,dismiss:l,update:a}}function Lt(){const[s,t]=d.useState(re);return d.useEffect(()=>(ae.push(t),()=>{const a=ae.indexOf(t);a>-1&&ae.splice(a,1)}),[s]),{...s,toast:Mt,dismiss:a=>X({type:"DISMISS_TOAST",toastId:a})}}const Pt=bs,ns=d.forwardRef(({className:s,...t},a)=>e.jsx(De,{ref:a,className:L("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...t}));ns.displayName=De.displayName;const Et=pt("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),is=d.forwardRef(({className:s,variant:t,...a},l)=>e.jsx(Ae,{ref:l,className:L(Et({variant:t}),s),...a}));is.displayName=Ae.displayName;const Tt=d.forwardRef(({className:s,...t},a)=>e.jsx(Ie,{ref:a,className:L("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",s),...t}));Tt.displayName=Ie.displayName;const os=d.forwardRef(({className:s,...t},a)=>e.jsx(Me,{ref:a,className:L("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...t,children:e.jsx(Le,{className:"h-4 w-4"})}));os.displayName=Me.displayName;const ls=d.forwardRef(({className:s,...t},a)=>e.jsx(Pe,{ref:a,className:L("text-sm font-semibold",s),...t}));ls.displayName=Pe.displayName;const cs=d.forwardRef(({className:s,...t},a)=>e.jsx(Ee,{ref:a,className:L("text-sm opacity-90",s),...t}));cs.displayName=Ee.displayName;function Ot(){const{toasts:s}=Lt();return e.jsxs(Pt,{children:[s.map(function({id:t,title:a,description:l,action:n,...c}){return e.jsxs(is,{...c,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(ls,{children:a}),l&&e.jsx(cs,{children:l})]}),n,e.jsx(os,{})]},t)}),e.jsx(ns,{})]})}const Kt=({...s})=>{const{theme:t="system"}=Ns();return e.jsx(ws,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Ft=Cs,Bt=d.forwardRef(({className:s,sideOffset:t=4,...a},l)=>e.jsx(Te,{ref:l,sideOffset:t,className:L("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));Bt.displayName=Te.displayName;function Rt(){const s=O();return d.useEffect(()=>{const t=setTimeout(()=>{s("/home")},4e3);return()=>clearTimeout(t)},[s]),e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white overflow-hidden",children:e.jsx("div",{className:"relative w-full h-screen max-w-md mx-auto flex items-center justify-center",children:e.jsx("img",{src:`media/splash.gif?v=${Math.floor(Date.now()/3e5)}`,alt:"Loading...",className:"w-full h-full object-contain"})})})}function ke(){var y;const s=O(),t=J(),[a,l]=d.useState(""),[n,c]=d.useState(""),[m,u]=d.useState(!1),[i,x]=d.useState(!1),f=((y=t.state)==null?void 0:y.returnTo)||"/home",v=r=>{r.preventDefault(),x(!0),setTimeout(()=>{const D=S.getUsers().find(p=>p.username===a&&p.password===n);D?(S.setCurrentUser(D),T.success(`Welcome back, ${D.fullName}!`),D.role==="admin"?s("/admin"):s(f)):T.error("Invalid username or password"),x(!1)},500)};return e.jsx("div",{className:"min-h-screen bg-background flex flex-col items-center justify-center p-6 animate-slide-left-fade",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-24 w-auto mx-auto mb-4 object-contain"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Discover Mount Kenya"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Sign in to continue"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"username",children:"Username"}),e.jsx(P,{id:"username",type:"text",placeholder:"Enter your username",value:a,onChange:r=>l(r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"password",type:m?"text":"password",placeholder:"Enter your password",value:n,onChange:r=>c(r.target.value),required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>u(!m),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:m?e.jsx(Oe,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsx(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground h-12 font-semibold",disabled:i,children:i?"Logging in...":"Login"})]}),e.jsxs(k,{type:"button",onClick:()=>s("/home"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-purple-300 hover:border-purple-400 bg-purple-50 hover:bg-purple-100 text-purple-700",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Return to Home"]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(E,{to:"/create-account",className:"text-primary font-medium hover:underline",children:"Create Account"})]})})]})})}function $t(){var i;const s=O(),t=J(),[a,l]=d.useState(!1),n=((i=t.state)==null?void 0:i.returnTo)||"/home",[c,m]=d.useState({fullName:"",password:"",phone:"",location:""}),u=x=>{x.preventDefault();const f=S.getUsers(),v={id:Date.now().toString(),username:c.fullName.split(" ")[0],password:c.password,fullName:c.fullName,phone:c.phone,location:c.location,role:"user"};f.push(v),S.saveUsers(f),S.setCurrentUser(v),T.success("Account created successfully!"),s(n)};return e.jsx("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:e.jsxs("div",{className:"max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-20 w-auto mx-auto mb-4 object-contain"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Create Account"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Join Discover Mount Kenya"})]}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"fullName",children:"Full Name"}),e.jsx(P,{id:"fullName",type:"text",placeholder:"Enter your full name",value:c.fullName,onChange:x=>m({...c,fullName:x.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(P,{id:"password",type:a?"text":"password",placeholder:"Create a password",value:c.password,onChange:x=>m({...c,password:x.target.value}),required:!0,className:"pr-10"}),e.jsx("button",{type:"button",onClick:()=>l(!a),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:a?e.jsx(Oe,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"phone",children:"Phone Number"}),e.jsx(P,{id:"phone",type:"tel",placeholder:"+254700000000",value:c.phone,onChange:x=>m({...c,phone:x.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"location",children:"Delivery Location"}),e.jsxs(Q,{value:c.location,onValueChange:x=>m({...c,location:x}),required:!0,children:[e.jsx(H,{children:e.jsx(Y,{placeholder:"Select your location"})}),e.jsxs(G,{children:[e.jsx(j,{value:"CBD",children:"CBD"}),e.jsx(j,{value:"Mukima",children:"Mukima"}),e.jsx(j,{value:"Baraka",children:"Baraka"}),e.jsx(j,{value:"Mugambi",children:"Mugambi"}),e.jsx(j,{value:"Katheri",children:"Katheri"}),e.jsx(j,{value:"MKWE",children:"MKWE"}),e.jsx(j,{value:"Likii",children:"Likii"}),e.jsx(j,{value:"Makutano",children:"Makutano"}),e.jsx(j,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsx(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 h-12 font-semibold",children:"Create Account"})]}),e.jsxs("div",{className:"space-y-3 mt-6",children:[e.jsxs(k,{type:"button",onClick:()=>s("/login"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-blue-300 hover:border-blue-400 bg-blue-50 hover:bg-blue-100 text-blue-700",children:[e.jsx(Ss,{className:"w-5 h-5 mr-2"}),"Back to Login"]}),e.jsxs(k,{type:"button",onClick:()=>s("/home"),variant:"outline",className:"w-full h-12 font-semibold border-2 border-purple-300 hover:border-purple-400 bg-purple-50 hover:bg-purple-100 text-purple-700",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Return to Home"]})]}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground mt-4",children:["Already have an account?"," ",e.jsx(E,{to:"/login",className:"text-primary font-medium hover:underline",children:"Sign in"})]})]})})}const qt=Ds,_t=ks,ds=d.forwardRef(({className:s,...t},a)=>e.jsx(Ke,{className:L("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));ds.displayName=Ke.displayName;const ms=d.forwardRef(({className:s,...t},a)=>e.jsxs(_t,{children:[e.jsx(ds,{}),e.jsx(Fe,{ref:a,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));ms.displayName=Fe.displayName;const us=({className:s,...t})=>e.jsx("div",{className:L("flex flex-col space-y-2 text-center sm:text-left",s),...t});us.displayName="AlertDialogHeader";const xs=({className:s,...t})=>e.jsx("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});xs.displayName="AlertDialogFooter";const hs=d.forwardRef(({className:s,...t},a)=>e.jsx(Be,{ref:a,className:L("text-lg font-semibold",s),...t}));hs.displayName=Be.displayName;const gs=d.forwardRef(({className:s,...t},a)=>e.jsx(Re,{ref:a,className:L("text-sm text-muted-foreground",s),...t}));gs.displayName=Re.displayName;const ps=d.forwardRef(({className:s,...t},a)=>e.jsx($e,{ref:a,className:L(Xe(),s),...t}));ps.displayName=$e.displayName;const fs=d.forwardRef(({className:s,...t},a)=>e.jsx(qe,{ref:a,className:L(Xe({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));fs.displayName=qe.displayName;function js({open:s,onConfirm:t,onCancel:a}){return e.jsx(qt,{open:s,onOpenChange:l=>!l&&a(),children:e.jsxs(ms,{className:"max-w-md border-2 border-primary/20",children:[e.jsxs(us,{children:[e.jsx("div",{className:"mx-auto bg-primary/10 p-4 rounded-full mb-4 w-fit",children:e.jsx(As,{className:"w-12 h-12 text-primary"})}),e.jsx(hs,{className:"text-2xl text-center font-bold text-primary",children:"Age Verification Required"}),e.jsxs(gs,{className:"text-center text-base mt-2",children:["You must be 18 years or older to enter the Beverages section.",e.jsx("br",{}),e.jsx("br",{}),"Are you 18 years of age or older?"]})]}),e.jsxs(xs,{className:"sm:justify-center gap-4 mt-4",children:[e.jsx(fs,{onClick:a,className:"w-full sm:w-auto min-w-[120px]",children:"No, I'm under 18"}),e.jsx(ps,{onClick:t,className:"w-full sm:w-auto min-w-[120px] bg-primary hover:bg-primary/90",children:"Yes, I'm 18+"})]})]})})}function _(){const s=[{to:"/home",icon:ee,label:"Home"},{to:"/categories",icon:Ms,label:"Categories"},{to:"/settings",icon:_e,label:"About Us"}];return e.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border z-50 safe-area-bottom",children:e.jsx("div",{className:"flex items-center justify-around h-16 max-w-lg mx-auto px-2",children:s.map(({to:t,icon:a,label:l})=>e.jsxs(Is,{to:t,className:({isActive:n})=>`flex flex-col items-center justify-center flex-1 h-full transition-colors ${n?"text-primary":"text-muted-foreground hover:text-foreground"}`,children:[e.jsx(a,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs font-medium",children:l})]},t))})})}function R(){const[s,t]=d.useState(S.getCurrentUser());return d.useEffect(()=>{const a=setInterval(()=>{const l=S.getCurrentUser();t(l)},500);return()=>clearInterval(a)},[]),d.useEffect(()=>{const a=S.getCurrentUser();t(a)},[]),d.useEffect(()=>{const a=()=>{const n=S.getCurrentUser();t(n)},l=()=>{t(null)};return window.addEventListener("storage",a),window.addEventListener("focus",a),window.addEventListener("userLogout",l),()=>{window.removeEventListener("storage",a),window.removeEventListener("focus",a),window.removeEventListener("userLogout",l)}},[]),e.jsx("header",{className:"bg-card border-b border-border sticky top-0 z-40",children:e.jsx("div",{className:"max-w-lg mx-auto px-4 py-4 flex items-center justify-between",children:e.jsx(E,{to:"/home",className:"cursor-pointer",children:e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-10 w-auto object-contain"})})})},(s==null?void 0:s.id)||"no-user")}function ve({className:s="",type:t="home"}){const[a,l]=d.useState(!0),n=Math.floor(Date.now()/3e5),c=`media/${t}hero.jpg?v=${n}`;return e.jsxs("div",{className:`rounded-2xl overflow-hidden shadow-card bg-muted relative ${s}`,style:{aspectRatio:"3/2"},children:[a&&e.jsx("div",{className:"absolute inset-0 bg-gray-100 dark:bg-zinc-800 flex items-center justify-center z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(he,{className:"w-8 h-8 animate-spin text-green-600"}),e.jsx("p",{className:"text-sm text-muted-foreground font-medium",children:"Loading experience..."})]})}),e.jsx("img",{src:c,alt:`${t} advertisement`,className:"w-full h-full object-contain bg-black/5",onLoad:()=>l(!1),onError:m=>{l(!1),console.error("Premium Banner failed to load:",c)},style:{opacity:a?0:1,transition:"opacity 0.5s ease-in-out"}})]})}function zt(){const[s,t]=d.useState(S.getCurrentUser()),[a,l]=d.useState(!1),n=ze(),{data:c=[],isLoading:m,error:u}=q({queryKey:["partners","promoted","home"],queryFn:()=>$.getPromoted(10),staleTime:1e3*60,gcTime:1e3*300,refetchOnMount:!0,retry:3,retryDelay:o=>Math.min(1e3*2**o,1e4)}),i=d.useMemo(()=>[...c].sort(()=>Math.random()-.5).slice(0,2),[c]);d.useEffect(()=>{let o=null;const N=$.onChanges(()=>{o&&clearTimeout(o),o=setTimeout(()=>{n.invalidateQueries({queryKey:["partners","promoted","home"]})},1500)});return()=>{o&&clearTimeout(o),N()}},[n]),d.useEffect(()=>{if(s){const o=S.getOrders().filter(N=>N.userId===s.id&&N.status==="delivered"&&!N.rated);l(o.length>0)}},[s]);const x=[{name:"Accommodation",icon:ee,color:"text-primary",link:"/category/accommodation"},{name:"Food Delivery",icon:ge,color:"text-destructive",link:"/category/restaurants"},{name:"Beverages",icon:Ue,color:"text-accent",link:"/category/beverages"},{name:"Activities",icon:pe,color:"text-success",link:"/category/activities"},{name:"Attractions",icon:Ve,color:"text-purple-500",link:"/category/attractions"},{name:"Shop",icon:fe,color:"text-orange-500",link:"/category/shop"}],f=O(),[v,y]=d.useState(!1),[r,w]=d.useState(null),D=async(o,N,h)=>{if(o.preventDefault(),N==="Beverages"){w(h),y(!0);return}if(N==="Food Delivery"){f(h);return}f(h)},p=async()=>{y(!1),f(r||"/category/beverages"),w(null)};return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-fade-in-up",children:[e.jsx(R,{}),e.jsx(js,{open:v,onConfirm:p,onCancel:()=>{y(!1),w(null)}}),a&&s&&e.jsx("div",{className:"max-w-lg mx-auto px-4 py-2",children:e.jsx(E,{to:"/orders",className:"block",children:e.jsxs("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-3 flex items-center gap-3 hover:bg-yellow-200 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-500 text-white rounded-full flex items-center justify-center",children:e.jsx(Ls,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Rate Your Orders"}),e.jsx("p",{className:"text-xs text-yellow-700",children:"You have delivered orders waiting for your review"})]})]})})}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsx(ve,{type:"home"}),!m&&i.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Featured"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(o=>e.jsxs(E,{to:`/business/${o.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx(B,{src:Array.isArray(o.image)?o.image[0]:o.image,alt:o.name,className:"w-full h-32 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:o.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:o.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",o.rating]})]})]},o.id))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Categories"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:x.map(o=>{const N=o.icon,h={Accommodation:"from-primary via-primary/90 to-primary/80","Food Delivery":"from-red-500 via-red-400 to-red-300",Beverages:"from-blue-500 via-blue-400 to-blue-300",Activities:"from-green-500 via-green-400 to-green-300",Attractions:"from-purple-500 via-purple-400 to-purple-300",Shop:"from-orange-500 via-orange-400 to-orange-300"}[o.name]||"from-gray-500 via-gray-400 to-gray-300";return e.jsxs("a",{href:o.link,onClick:C=>D(C,o.name,o.link),className:`bg-gradient-to-br ${h} rounded-xl p-6 shadow-lg hover:shadow-xl transition-all hover:scale-105 border-2 border-white/20 block cursor-pointer`,children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-3 text-white drop-shadow-lg"}),e.jsx("p",{className:"text-center font-bold text-sm text-white drop-shadow-md",children:o.name})]},o.name)})})]})]}),e.jsx(_,{})]})}function Ut(){const s=O(),[t,a]=d.useState(!1),[l,n]=d.useState(null),c=ze();q({queryKey:["partners","categories"],queryFn:()=>$.getAll(),refetchOnMount:!0,retry:3,retryDelay:p=>Math.min(1e3*2**p,1e4)});const{data:m=[],isLoading:u}=q({queryKey:["partners","promoted","categories"],queryFn:()=>$.getPromoted(10),refetchOnMount:!0,retry:3,retryDelay:p=>Math.min(1e3*2**p,1e4)}),i=d.useMemo(()=>[...m].sort(()=>Math.random()-.5).slice(0,2),[m]);d.useEffect(()=>{let p=null;const o=$.onChanges(()=>{p&&clearTimeout(p),p=setTimeout(()=>{c.invalidateQueries({queryKey:["partners","categories"]}),c.invalidateQueries({queryKey:["partners","promoted","categories"]})},1500)});return()=>{p&&clearTimeout(p),o()}},[c]);const x=[{name:"Accommodation",icon:ee,color:"from-primary via-primary/90 to-primary/80",path:"/category/accommodation"},{name:"Food Delivery",icon:ge,color:"from-red-500 via-red-400 to-red-300",path:"/category/restaurants"},{name:"Beverages",icon:Ue,color:"from-blue-500 via-blue-400 to-blue-300",path:"/category/beverages"},{name:"Activities",icon:pe,color:"from-green-500 via-green-400 to-green-300",path:"/category/activities"},{name:"Attractions",icon:Ve,color:"from-purple-500 via-purple-400 to-purple-300",path:"/category/attractions"},{name:"Shop",icon:fe,color:"from-orange-500 via-orange-400 to-orange-300",path:"/category/shop"}],f=Math.floor(Date.now()/3e5),v="/discovermtkenya/".endsWith("/")?"/discovermtkenya/":"/discovermtkenya//",y=p=>`${v}${p.replace(/^\//,"")}?v=${f}`,r=p=>({Accommodation:y("media/accommodation.jpg"),"Food Delivery":y("media/food.jpg"),Beverages:y("media/beverages.jpg"),Activities:y("media/activities.jpg"),Attractions:y("media/attractions.jpg"),Shop:y("media/shop.jpg")})[p]||y("media/food.jpg"),w=async(p,o,N)=>{if(p.preventDefault(),o==="Beverages"){n(N),a(!0);return}if(o==="Food Delivery"){s(N);return}s(N)},D=async()=>{a(!1),s(l||"/category/beverages"),n(null)};return e.jsxs("div",{className:"relative min-h-screen bg-background pb-20 animate-fade-in-up",children:[e.jsx(R,{}),e.jsx(js,{open:t,onConfirm:D,onCancel:()=>{a(!1),n(null)}}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-2 space-y-6",children:[e.jsx(ve,{type:"categories"}),i.length>0&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Featured"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(p=>e.jsxs(E,{to:`/business/${p.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx(B,{src:Array.isArray(p.image)?p.image[0]:p.image,alt:p.name,className:"w-full h-32 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:p.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:p.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",p.rating]})]})]},p.id))})]}),x.map(p=>e.jsxs("a",{href:p.path,onClick:o=>w(o,p.name,p.path),className:"block relative bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-all hover:scale-[1.02] cursor-pointer",children:[e.jsx(B,{src:r(p.name),alt:p.name,className:"w-full h-48 object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:p.name}),e.jsx("p",{className:"text-sm text-white/90",children:p.name==="Food Delivery"?"Explore meal options":`Explore ${p.name.toLowerCase()} options`})]})]},p.name))]}),e.jsx(_,{})]})}const Vt=Math.floor(Date.now()/3e5),Wt="/discovermtkenya/".endsWith("/")?"/discovermtkenya/":"/discovermtkenya//",U=s=>`${Wt}${s.replace(/^\//,"")}?v=${Vt}`;function Qt(){const{category:s}=je();O();const[t,a]=d.useState(""),{data:l=[],isLoading:n,error:c,isFetching:m}=q({queryKey:["partners","category",s],queryFn:()=>s?$.getByCategory(s,{pageSize:100}):[],enabled:!!s,retry:3,retryDelay:r=>Math.min(1e3*2**r,1e4),refetchOnMount:!0,placeholderData:r=>r}),{data:u=[],isLoading:i}=q({queryKey:["menu","promoted",s],queryFn:()=>{if(!s)return[];const r=s.toLowerCase().includes("food")||s.toLowerCase().includes("restaurant")?"restaurant":s.toLowerCase().includes("beverage")?"beverage":s.toLowerCase().includes("shop")?"shop":s.toLowerCase().includes("activities")?"activities":s.toLowerCase().includes("attractions")?"attractions":s;return Ze.getPromoted(r,10)},enabled:!!s}),x=d.useMemo(()=>l.filter(r=>{var w;return r.name.toLowerCase().includes(t.toLowerCase())||((w=r.description)==null?void 0:w.toLowerCase().includes(t.toLowerCase()))}),[l,t]),f=r=>r.category==="accommodation"?r.pricePerNight?`KES ${r.pricePerNight.toLocaleString()}/night`:"Prices in KES":r.category==="attractions"?r.pricePerNight?`KES ${r.pricePerNight.toLocaleString()}`:"Prices in KES":r.category==="activities"?r.pricePerPerson?`KES ${r.pricePerPerson.toLocaleString()}/person`:"Prices in KES":(r.category==="shop","Prices in KES"),y=(r=>{const w=r==null?void 0:r.toLowerCase();return w==="restaurants"||w==="food delivery"||w==="food"?"Food Delivery":w==="beverages"?"Beverages":w==="shop"||w==="dmk shop"?"DMK Shop":w==="activities"?"Activities":w==="attractions"?"Attractions":w==="accommodation"?"Accommodation":r==null?void 0:r.replace("-"," ").replace(/\b\w/g,D=>D.toUpperCase())})(s||"");return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(P,{placeholder:`Search ${y}...`,value:t,onChange:r=>a(r.target.value),className:"pl-9 bg-card/50 border-muted-foreground/20 focus-visible:ring-primary/20 transition-all hover:bg-card/80"})]}),s&&e.jsx("div",{className:"rounded-sm overflow-hidden shadow-lg border border-primary/10 animate-in fade-in slide-in-from-bottom-4 duration-700",children:e.jsx(B,{src:s.toLowerCase().includes("beverage")?U("media/beverageshero.jpg"):s.toLowerCase().includes("activities")?U("media/activitieshero.jpg"):s.toLowerCase().includes("shop")?U("media/shophero.jpg"):s.toLowerCase().includes("attractions")?U("media/attractionshero.jpg"):s.toLowerCase().includes("accommodation")?U("media/accommodationhero.jpg"):U("media/foodhero.jpg"),alt:"Premium Advertisement",className:"w-full aspect-[3/2] object-contain bg-black/5"})}),u.length>0&&e.jsxs("div",{className:"space-y-2 pt-1",children:[e.jsx("div",{className:"flex items-center justify-between px-1",children:e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-primary fill-primary"}),"Featured"]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:u.map(r=>e.jsxs(E,{to:`/business/${r.partner_id}`,className:"bg-card rounded-2xl overflow-hidden shadow-md border border-primary/5 hover:shadow-lg transition-all active:scale-95 group",children:[e.jsxs("div",{className:"relative",children:[e.jsx(B,{src:r.image||"",alt:r.name,className:"w-full h-32 object-cover group-hover:scale-105 transition-transform duration-500"}),e.jsxs("div",{className:"absolute top-2 right-2 bg-primary/90 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-lg",children:["KES ",r.price.toLocaleString()]})]}),e.jsx("div",{className:"p-3",children:e.jsx("h4",{className:"font-bold text-sm line-clamp-1 group-hover:text-primary transition-colors",children:r.name})})]},r.id))})]}),e.jsx("h1",{className:"text-2xl font-bold px-1",children:y}),n&&l.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(he,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})]}),c&&!n&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ps,{className:"w-12 h-12 mx-auto mb-4 text-red-500"}),e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Failed to load content"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm",children:"Retry"})]}),x.map(r=>e.jsxs(E,{to:`/business/${r.id}`,className:"block bg-card rounded-2xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx(B,{src:Array.isArray(r.image)?r.image[0]:r.image,alt:r.name,className:"w-full h-48 object-cover",loading:"lazy"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:r.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2 flex-wrap",children:[(r.category==="accommodation"||r.category==="activities"||r.category==="attractions")&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4 text-primary fill-primary"}),r.rating]}),r.category==="accommodation"&&r.propertyType&&e.jsx("span",{className:"px-2 py-0.5 bg-primary/10 text-primary rounded-full font-medium",children:r.propertyType}),e.jsx("span",{className:"capitalize",children:r.category==="restaurant"?"Food Delivery":r.category==="beverage"?"Beverages":r.category==="shop"?"Shop":r.category}),e.jsx("span",{children:f(r)})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4 line-clamp-2",children:r.description}),e.jsxs("div",{className:"inline-flex items-center gap-2 text-primary font-bold group-hover:gap-3 transition-all",children:[e.jsx(V,{className:"w-4 h-4"}),r.category==="accommodation"?"View Property":r.category==="activities"?"View Activity":r.category==="restaurant"?"View Restaurant":r.category==="beverage"?"View Beverages":r.category==="attractions"?"View Attraction":r.category==="shop"?"View Shop":"View Details"]})]})]},r.id)),!n&&l.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground mb-4",children:"No items found in this category."})})]}),e.jsx(_,{})]})}function Ht({message:s="Loading...",fullscreen:t=!0,className:a}){return e.jsx("div",{className:L("z-50 flex items-center justify-center bg-background/90 text-center text-sm text-muted-foreground backdrop-blur",t?"fixed inset-0":"absolute inset-0",a),children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(he,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("p",{className:"font-medium text-foreground/80",children:s})]})})}function Yt(){var C;const{id:s}=je(),t=O(),[a,l]=d.useState(0),[n,c]=d.useState(""),[m,u]=d.useState([]),{data:i,isLoading:x}=q({queryKey:["partner",s],queryFn:()=>s?$.getById(s):null,enabled:!!s}),{data:f=[],isLoading:v}=q({queryKey:["menu",s],queryFn:()=>s?Ze.getByPartner_id(s):[],enabled:!!s&&!!i}),y=d.useMemo(()=>f.filter(g=>g.name.toLowerCase().includes(n.toLowerCase())||g.description.toLowerCase().includes(n.toLowerCase())),[f,n]),r=x||v;d.useEffect(()=>{i&&i.category&&(async()=>{const g=await $.getSimilar(i.category,i.id,2);u(g)})()},[i]);const w=d.useMemo(()=>f.length===0?null:f.reduce((b,M)=>b+(M.price||0),0)/f.length,[f]),D=async g=>{if(!i)return;const b=i.category==="accommodation"?i.pricePerNight??null:i.category==="activities"?i.pricePerPerson??null:(i.category==="restaurant"||i.category==="beverage")&&w?w:null;await ft.logInteraction({partnerId:i.id,partnerCategory:i.category,actionType:i.category==="restaurant"||i.category==="beverage"?"order_call":i.category==="activities"?"activity_call":"book_call",actionSource:g,estimatedValue:b,deviceType:/Mobi|Android/i.test(navigator.userAgent)?"mobile":"desktop",metadata:{partnerName:i.name}})},p=async(g,b)=>{await D(b),window.location.href=`tel:${g}`},o=g=>({"Swimming Pool":Fs,Activities:Bs,"Delivery Services":W,"Amazing Views":V,"Spacious Living":Rs,Bathtub:$s,"Serene Location":pe})[g]||V,N=g=>({"Self Catering":we,WiFi:qs,Toiletries:_s,"Coffee/Tea Station":Ne,"Chef's Kitchen":we,"Smart TV":zs})[g]||V;if(r)return e.jsxs("div",{className:"relative min-h-screen bg-background",children:[e.jsx(R,{}),e.jsx(Ht,{message:"Loading partner details..."})]});if(!i&&!r)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold mb-2",children:"Partner not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The partner you're looking for doesn't exist."}),e.jsx("button",{onClick:()=>t(-1),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Go Back"})]})});const h=Array.isArray(i.image)?i.image:[i.image];return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("header",{className:"relative",children:[e.jsx("button",{onClick:()=>t(`/category/${i.category}`),className:"absolute top-4 left-4 z-10 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center shadow-lg hover:bg-white transition-colors",title:"Back to category",children:e.jsx(Es,{className:"w-5 h-5"})}),h.length>0&&e.jsx(B,{src:h[a],alt:i.name,className:"w-full h-64 object-cover"}),h.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2",children:h.map((g,b)=>e.jsx("button",{onClick:()=>l(b),className:`w-2 h-2 rounded-full ${a===b?"bg-white":"bg-white/50"}`},b))})]}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 -mt-8 relative z-10",children:[e.jsxs("div",{className:"bg-card rounded-2xl p-6 shadow-card",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:i.name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:i.description}),i.category!=="restaurant"&&i.category!=="beverage"&&i.category!=="shop"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"w-4 h-4 text-primary fill-primary"}),e.jsx("span",{className:"font-medium",children:i.rating})]})]}),(i.category==="accommodation"||i.category==="attractions")&&e.jsxs("div",{className:"space-y-4 mt-6",children:[h.length>1&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:h.slice(0,4).map((g,b)=>e.jsx(B,{src:g,alt:`${i.name} ${b+1}`,className:"w-full h-32 object-cover rounded-xl",onClick:()=>l(b)},b))}),e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card grid grid-cols-2 gap-4",children:[i.category==="accommodation"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bedrooms"}),e.jsx("p",{className:"font-semibold",children:i.bedrooms||"N/A"})]})]}),i.category==="accommodation"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Guests"}),e.jsx("p",{className:"font-semibold",children:i.guests||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Location"}),e.jsx("p",{className:"font-semibold text-sm",children:i.location})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ks,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Price"}),e.jsxs("p",{className:"font-semibold",children:["KES ",((C=i.pricePerNight)==null?void 0:C.toLocaleString())||"N/A",i.category==="accommodation"?"/night":""]})]})]})]}),i.features&&i.features.length>0&&e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Features"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.features.map((g,b)=>{const M=o(g);return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:g})]},b)})})]}),i.amenities&&i.amenities.length>0&&e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-card",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Amenities"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.amenities.map((g,b)=>{const M=N(g);return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:g})]},b)})})]}),e.jsxs(k,{onClick:()=>p(i.phone,"business_page"),className:"w-full bg-primary hover:bg-primary/90 text-white text-lg py-6",children:[e.jsx(W,{className:"w-5 h-5 mr-2"}),i.category==="attractions"?"Learn More":"Book Now"]})]}),(i.category==="restaurant"||i.category==="beverage"||i.category==="shop"||i.category==="activities")&&e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(P,{type:"text",placeholder:i.category==="shop"?"Search products...":i.category==="activities"?"Search services...":i.category==="beverage"?"Search beverages...":"Search menu items...",value:n,onChange:g=>c(g.target.value),className:"pl-10 bg-card border-border/50"})]}),y.length>0?e.jsx(be.div,{className:"space-y-4",initial:"hidden",animate:"show",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},children:y.map(g=>e.jsxs(be.div,{variants:{hidden:{opacity:0,x:-20},show:{opacity:1,x:0}},className:"bg-card rounded-xl overflow-hidden shadow-sm border border-border/50 flex",children:[e.jsx("div",{className:"w-24 h-24 sm:w-32 sm:h-32 flex-shrink-0",children:g.image?e.jsx(B,{src:g.image,alt:g.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted/30 flex items-center justify-center",children:e.jsx(Ne,{className:"w-8 h-8 text-muted-foreground/30"})})}),e.jsxs("div",{className:"p-3 flex-1 flex flex-col justify-center",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1 gap-2",children:[e.jsx("h4",{className:"font-semibold text-base leading-snug",children:g.name}),e.jsxs("span",{className:"font-bold text-primary text-sm whitespace-nowrap",children:["KES ",g.price.toLocaleString()]})]}),g.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:g.description})]})]},g.id))}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsxs("p",{children:['No menu items found matching "',n,'"']})}),e.jsxs(k,{onClick:()=>p(i.phone,"business_page"),className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 text-white text-lg py-6 shadow-lg shadow-primary/20 rounded-xl transition-all duration-300 transform hover:scale-[1.02]",children:[e.jsx(W,{className:"w-5 h-5 mr-2 animate-pulse"}),"Call to Order"]})]}),m.length>0&&e.jsxs("section",{className:"mt-8",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Similar Partners"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.map(g=>e.jsxs(E,{to:`/business/${g.id}`,className:"bg-card rounded-xl overflow-hidden shadow-card hover:shadow-hover transition-shadow",children:[e.jsx(B,{src:Array.isArray(g.image)?g.image[0]:g.image,alt:g.name,className:"w-full h-32 object-cover"}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:g.name}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:g.category}),e.jsxs("p",{className:"text-xs text-primary font-medium mt-1",children:["⭐ ",g.rating]})]})]},g.id))})]})]}),e.jsx(_,{})]})}function Gt(){const s=O(),[t,a]=d.useState([]),[l,n]=d.useState("CBD"),[c,m]=d.useState([]),[u,i]=d.useState(!1),x=S.getCurrentUser();d.useEffect(()=>{const h=()=>{a(S.getCart());const b=S.getOrders().filter(M=>M.userId===(x==null?void 0:x.id));m(b.sort((M,K)=>new Date(K.timestamp).getTime()-new Date(M.timestamp).getTime()))};h();const C=setInterval(h,2e3);return()=>clearInterval(C)},[x]);const f=(h,C)=>{const g=t.map(b=>{if(b.menuItem.id===h){const M=Math.max(1,b.quantity+C);return{...b,quantity:M}}return b});a(g),S.saveCart(g)},v=h=>{const C=t.filter(g=>g.menuItem.id!==h);a(C),S.saveCart(C),T.success("Item removed from cart")},y={CBD:70,Mukima:100,Baraka:150,Mugambi:120,Katheri:200,MKWE:200,Likii:70,Makutano:100,Airstrip:250},r=t.reduce((h,C)=>h+C.menuItem.price*C.quantity,0),w=y[l]||70,D=r+w,p=()=>{if(t.length===0){T.error("Your cart is empty");return}if(!x){T.error("Please login to continue with your order"),s("/login",{state:{returnTo:"/cart"}});return}s("/checkout")},o=h=>({placed:"bg-info text-info-foreground",confirming:"bg-warning text-warning-foreground",preparing:"bg-primary text-primary-foreground",dispatched:"bg-accent text-accent-foreground",nearby:"bg-success text-success-foreground",delivered:"bg-success text-success-foreground"})[h]||"bg-muted text-muted-foreground",N=h=>({placed:"Placed",confirming:"Confirming",preparing:"Preparing",dispatched:"On the Way",nearby:"Nearby",delivered:"Delivered"})[h];return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6",children:[e.jsx(ve,{className:"mb-6"}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"My Orders"}),c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No orders yet"}),e.jsx(E,{to:"/home",className:"inline-block px-6 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90",children:"Start Shopping"})]}):e.jsx("div",{className:"space-y-4",children:c.map(h=>e.jsxs(E,{to:`/order-tracking/${h.id}`,className:"block bg-card rounded-xl p-4 shadow-card hover:shadow-hover transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["Order #",h.id]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[new Date(h.timestamp).toLocaleDateString()," at"," ",new Date(h.timestamp).toLocaleTimeString()]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${o(h.status)}`,children:N(h.status)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.items.length," items"]}),e.jsxs("p",{className:"font-semibold text-primary",children:["KES ",h.total]})]}),e.jsx(He,{className:"w-5 h-5 text-muted-foreground"})]})]},h.id))})]}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Your cart is empty"}),e.jsx(E,{to:"/home",children:e.jsx(k,{className:"bg-primary hover:bg-primary/90",children:"Start Shopping"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4 mb-6",children:t.map(h=>e.jsx("div",{className:"bg-card rounded-xl p-4 shadow-card",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:h.menuItem.image,alt:h.menuItem.name,className:"w-20 h-20 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold mb-1",children:h.menuItem.name}),e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["KES ",h.menuItem.price]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-muted rounded-lg",children:[e.jsx("button",{onClick:()=>f(h.menuItem.id,-1),className:"p-2 hover:bg-muted-foreground/10 rounded-lg",children:e.jsx(Us,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium w-8 text-center",children:h.quantity}),e.jsx("button",{onClick:()=>f(h.menuItem.id,1),className:"p-2 hover:bg-muted-foreground/10 rounded-lg",children:e.jsx(Vs,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>v(h.menuItem.id),className:"ml-auto text-destructive hover:bg-destructive/10 p-2 rounded-lg",children:e.jsx(Ws,{className:"w-4 h-4"})})]})]})]})},h.menuItem.id))}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Delivery Location"}),e.jsxs(Q,{value:l,onValueChange:n,children:[e.jsx(H,{children:e.jsx(Y,{})}),e.jsxs(G,{children:[e.jsx(j,{value:"CBD",children:"CBD"}),e.jsx(j,{value:"Mukima",children:"Mukima"}),e.jsx(j,{value:"Baraka",children:"Baraka"}),e.jsx(j,{value:"Mugambi",children:"Mugambi"}),e.jsx(j,{value:"Katheri",children:"Katheri"}),e.jsx(j,{value:"MKWE",children:"MKWE"}),e.jsx(j,{value:"Likii",children:"Likii"}),e.jsx(j,{value:"Makutano",children:"Makutano"}),e.jsx(j,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsxs("div",{className:"border-t border-border pt-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["KES ",r]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{className:"font-medium",children:["KES ",w]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-border",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",D]})]})]}),e.jsx(E,{to:"/home",className:"block",children:e.jsxs(k,{variant:"outline",className:"w-full h-12 mb-3 flex items-center justify-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Continue Shopping"]})}),e.jsxs(k,{onClick:p,className:"w-full bg-primary hover:bg-primary/90 h-12",children:["Checkout - KES ",D]})]})]})]}),e.jsx(_,{})]})}const vs=d.forwardRef(({className:s,...t},a)=>e.jsx(Ye,{className:L("grid gap-2",s),...t,ref:a}));vs.displayName=Ye.displayName;const xe=d.forwardRef(({className:s,...t},a)=>e.jsx(Ge,{ref:a,className:L("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Qs,{className:"flex items-center justify-center",children:e.jsx(Hs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));xe.displayName=Ge.displayName;function Jt({open:s,onOpenChange:t,partnerName:a,onRate:l}){const[n,c]=d.useState(0),[m,u]=d.useState(""),i=()=>{n>0&&(l(n,m),c(0),u(""),t(!1))},x=y=>y<n?e.jsx(Z,{className:"w-8 h-8 text-yellow-500 fill-yellow-500"}):e.jsx(Z,{className:"w-8 h-8 text-gray-300"}),f=()=>{switch(n){case 1:return"Poor experience";case 2:return"Below average";case 3:return"Average";case 4:return"Good experience";case 5:return"Excellent!";default:return"How was your experience?"}},v=()=>{switch(n){case 1:return"😞";case 2:return"😐";case 3:return"🙂";case 4:return"😊";case 5:return"🤩";default:return"⭐"}};return e.jsx(es,{open:s,onOpenChange:t,children:e.jsxs(ss,{className:"max-w-md",children:[e.jsx(ts,{children:e.jsx(as,{className:"text-center",children:"Rate Your Experience"})}),e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"How was your order experience?"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center gap-2",children:[1,2,3,4,5].map(y=>e.jsx("button",{onClick:()=>c(y),className:"transition-transform hover:scale-110",children:x(y)},y))}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:v()}),e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:f()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Leave a comment (optional)"}),e.jsx(rs,{value:m,onChange:y=>u(y.target.value),placeholder:"Tell us about your experience...",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{onClick:i,disabled:n===0,className:"flex-1 bg-primary hover:bg-primary/90",children:[e.jsx(Ys,{className:"w-4 h-4 mr-2"}),"Submit Rating"]}),e.jsx(k,{variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"Skip"})]})]})]})})}function Xt(){const s=O(),t=S.getCurrentUser(),a=S.getCart(),[l,n]=d.useState("MPESA"),[c,m]=d.useState((t==null?void 0:t.location)||"CBD"),[u,i]=d.useState((t==null?void 0:t.fullName)||""),[x,f]=d.useState((t==null?void 0:t.phone)||""),[v,y]=d.useState(!1),[r,w]=d.useState(null),D={CBD:70,Mukima:100,Baraka:150,Mugambi:120,Katheri:200,MKWE:200,Likii:70,Makutano:100,Airstrip:250},p=a.reduce((b,M)=>b+M.menuItem.price*M.quantity,0),o=D[c]||70,N=p+o,h=b=>{var z,ye;b.preventDefault();const M=S.getOrders(),K={id:`ORD${Date.now()}`,userId:(t==null?void 0:t.id)||"guest",partnerId:((z=a[0])==null?void 0:z.menuItem.partnerId)||"",partnerName:C(((ye=a[0])==null?void 0:ye.menuItem.partnerId)||""),items:[...a],total:N,deliveryFee:o,deliveryLocation:c,paymentMethod:l,status:"placed",timestamp:new Date().toISOString(),customerName:u,customerPhone:x};M.push(K),S.saveOrders(M),S.saveCart([]),w(K),y(!0),T.success("Order placed successfully!")},C=b=>{var K;return((K=S.getPartners().find(z=>z.id===b))==null?void 0:K.name)||"Unknown Partner"},g=(b,M)=>{if(r){const K=S.getReviews(),z={id:`REV${Date.now()}`,userId:(t==null?void 0:t.id)||"guest",userName:(t==null?void 0:t.fullName)||"Guest",partnerId:r.partnerId,orderId:r.id,rating:b,comment:M,approved:!1,createdAt:new Date().toISOString()};K.push(z),S.saveReviews(K),T.success("Thank you for your feedback!")}s(`/order-tracking/${r==null?void 0:r.id}`)};return e.jsxs("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:[e.jsx(R,{}),e.jsx("div",{className:"max-w-lg mx-auto px-4 py-6",children:e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Delivery Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"name",children:"Full Name"}),e.jsx(P,{id:"name",value:u,onChange:b=>i(b.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"phone",children:"Phone Number"}),e.jsx(P,{id:"phone",type:"tel",value:x,onChange:b=>f(b.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"location",children:"Delivery Location"}),e.jsxs(Q,{value:c,onValueChange:m,required:!0,children:[e.jsx(H,{children:e.jsx(Y,{})}),e.jsxs(G,{children:[e.jsx(j,{value:"CBD",children:"CBD"}),e.jsx(j,{value:"Mukima",children:"Mukima"}),e.jsx(j,{value:"Baraka",children:"Baraka"}),e.jsx(j,{value:"Mugambi",children:"Mugambi"}),e.jsx(j,{value:"Katheri",children:"Katheri"}),e.jsx(j,{value:"MKWE",children:"MKWE"}),e.jsx(j,{value:"Likii",children:"Likii"}),e.jsx(j,{value:"Makutano",children:"Makutano"}),e.jsx(j,{value:"Airstrip",children:"Airstrip"})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Payment Method"}),e.jsxs(vs,{value:l,onValueChange:n,children:[e.jsxs("div",{className:"flex items-center space-x-2 p-4 border border-border rounded-lg cursor-pointer hover:bg-muted",children:[e.jsx(xe,{value:"MPESA",id:"mpesa"}),e.jsxs(A,{htmlFor:"mpesa",className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:"MPESA"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay via MPESA mobile money"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 border border-border rounded-lg cursor-pointer hover:bg-muted",children:[e.jsx(xe,{value:"Card",id:"card"}),e.jsxs(A,{htmlFor:"card",className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"font-medium",children:"Card Payment"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Pay with debit/credit card"})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["KES ",p]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{children:["KES ",o]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-3 border-t border-border",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",N]})]})]})]}),e.jsxs(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 h-12 text-lg",children:["Place Order - KES ",N]})]})}),e.jsx(Jt,{open:v,onOpenChange:y,partnerName:(r==null?void 0:r.partnerName)||"",onRate:g})]})}function Zt({locations:s,selectedLocation:t,onLocationSelect:a,showRiderTracking:l=!1,riderLocation:n,estimatedDelivery:c}){const[m]=d.useState({lat:-.02,lng:37.0739}),[u,i]=d.useState(null),x=f=>{i(f),a(f)};return e.jsxs("div",{className:"w-full h-96 bg-gradient-to-br from-blue-50 to-green-50 rounded-xl border-2 border-blue-200 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-400/20 to-blue-400/20",children:e.jsx("div",{className:"absolute inset-0 opacity-30"})}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),e.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs font-medium text-gray-700 bg-white px-2 py-1 rounded shadow",children:"Nanyuki Center"})]}),s.map((f,v)=>{const y=50+(f.coordinates.lng-m.lng)*1e3,r=50+(f.coordinates.lat-m.lat)*1e3;return e.jsxs("div",{className:"absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2",style:{left:`${Math.max(10,Math.min(90,y))}%`,top:`${Math.max(10,Math.min(90,r))}%`},onClick:()=>x(f),children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 border-white shadow-lg flex items-center justify-center transition-all duration-200 ${t===f.id?"bg-primary scale-110":"bg-blue-500 hover:bg-blue-600"}`,children:e.jsx(ne,{className:"w-4 h-4 text-white"})}),e.jsx("div",{className:`absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs font-medium bg-white px-2 py-1 rounded shadow whitespace-nowrap ${t===f.id?"text-primary":"text-gray-700"}`,children:f.name})]},f.id)}),l&&n&&e.jsxs("div",{className:"absolute cursor-pointer transform -translate-x-1/2 -translate-y-1/2 animate-pulse",style:{left:`${50+(n.lng-m.lng)*1e3}%`,top:`${50+(n.lat-m.lat)*1e3}%`},children:[e.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs font-medium bg-orange-100 text-orange-800 px-2 py-1 rounded shadow",children:"Rider"})]}),e.jsx("div",{className:"absolute top-4 right-4 flex flex-col gap-2",children:e.jsx(k,{size:"sm",variant:"secondary",className:"bg-white/90 backdrop-blur-sm",children:e.jsx(ue,{className:"w-4 h-4"})})}),u&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:e.jsx(se,{className:"bg-white/95 backdrop-blur-sm",children:e.jsx(te,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:u.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Delivery Fee: KES ",u.fee]})]}),c&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:c})]})]})})})}),e.jsx("div",{className:"absolute top-4 left-4 bg-white/90 backdrop-blur-sm px-3 py-2 rounded-lg shadow",children:e.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Service Area: 15km radius"})})]})}const me=s=>({CBD:{lat:-.02,lng:37.0739},Mukima:{lat:-.025,lng:37.08},Baraka:{lat:-.015,lng:37.06},Mugambi:{lat:-.03,lng:37.07},Katheri:{lat:-.01,lng:37.09},MKWE:{lat:-.035,lng:37.055},Likii:{lat:-.02,lng:37.065},Makutano:{lat:-.025,lng:37.075},Airstrip:{lat:-.018,lng:37.078}})[s]||{lat:-.02,lng:37.0739};function ea({orderId:s,customerLocation:t,estimatedDelivery:a}){const[l,n]=d.useState(null),[c,m]=d.useState("picked_up");d.useEffect(()=>{const x={id:"rider1",name:"John Kamau",phone:"+254720123456",location:me("CBD"),status:"picked_up"};n(x);const f=setInterval(()=>{n(v=>{if(!v)return null;const y=me(t),r=v.location,w=r.lat+(y.lat-r.lat)*.1,D=r.lng+(y.lng-r.lng)*.1,p=w-y.lat,o=D-y.lng,N=Math.sqrt(p*p+o*o);let h=v.status;return N<.005?h="arrived":N<.01?h="nearby":N<.02&&(h="on_the_way"),m(h),{...v,location:{lat:w,lng:D},status:h}})},3e3);return()=>clearInterval(f)},[t]);const u=x=>{switch(x){case"picked_up":return"Your order has been picked up and is on the way!";case"on_the_way":return"Your rider is on the way to your location";case"nearby":return"Your rider is nearby and will arrive shortly";case"arrived":return"Your rider has arrived at your location";default:return"Tracking your order..."}},i=x=>{switch(x){case"picked_up":return"text-blue-600 bg-blue-100";case"on_the_way":return"text-yellow-600 bg-yellow-100";case"nearby":return"text-orange-600 bg-orange-100";case"arrived":return"text-green-600 bg-green-100";default:return"text-gray-600 bg-gray-100"}};return l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(se,{className:"shadow-lg",children:[e.jsx(oe,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-primary"}),"Order Tracking - #",s]})}),e.jsxs(te,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${i(c)}`,children:c.replace("_"," ").toUpperCase()}),e.jsx(Je,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u(c)}),e.jsxs("div",{className:"flex items-center gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-medium",children:l.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery Partner"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Call"]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"}),"Message"]})]})]})]})]}),e.jsxs(se,{className:"shadow-lg",children:[e.jsx(oe,{children:e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-primary"}),"Live Tracking"]})}),e.jsx(te,{children:e.jsx(Zt,{locations:[{id:t,name:t,fee:0,coordinates:me(t)}],selectedLocation:t,onLocationSelect:()=>{},showRiderTracking:!0,riderLocation:l.location,estimatedDelivery:a})})]}),e.jsxs(se,{className:"shadow-lg",children:[e.jsx(oe,{children:e.jsx(le,{children:"Delivery Instructions"})}),e.jsx(te,{children:e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:"• Please ensure someone is available to receive the order"}),e.jsx("p",{children:"• Have your payment ready if paying on delivery"}),e.jsx("p",{children:"• Contact the rider directly if you need to provide additional directions"}),e.jsxs("p",{children:["• Your order will be delivered to: ",e.jsx("strong",{children:t})]})]})})]})]}):e.jsx("div",{className:"w-full h-64 bg-muted rounded-xl flex items-center justify-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Loading rider information..."})})}function sa(){const{id:s}=je(),t=O(),[a,l]=d.useState(null);if(d.useEffect(()=>{const m=()=>{const x=S.getOrders().find(f=>f.id===s);x&&l(x)};m();const u=setInterval(m,2e3);return()=>clearInterval(u)},[s]),!a)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx("p",{children:"Order not found"})});const n=[{status:"placed",label:"Placed",icon:Qe,color:"bg-blue-500"},{status:"preparing",label:"Preparing",icon:ge,color:"bg-yellow-500"},{status:"dispatched",label:"On the Way",icon:Xs,color:"bg-orange-500"},{status:"delivered",label:"Delivered",icon:Zs,color:"bg-green-500"}],c=n.findIndex(m=>m.status===a.status);return e.jsxs("div",{className:"min-h-screen bg-background animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card mb-6",children:[e.jsx("div",{className:"flex justify-between mb-8",children:n.map((m,u)=>{const i=u<=c,x=m.icon;return e.jsxs("div",{className:"flex flex-col items-center flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-2 transition-colors ${i?`${m.color} text-white`:"bg-gray-300 text-gray-500"}`,children:e.jsx(x,{className:"w-6 h-6"})}),e.jsx("span",{className:`text-xs font-medium text-center ${i?"text-gray-800":"text-gray-500"}`,children:m.label}),u<n.length-1&&e.jsx("div",{className:`absolute h-0.5 w-1/4 top-6 ${i?"bg-primary":"bg-muted"}`,style:{left:`${(u+.5)*25}%`}})]},m.status)})}),a.status!=="delivered"&&e.jsxs("div",{className:"bg-muted rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Estimated delivery"}),e.jsx("p",{className:"text-xl font-bold text-primary",children:"30-45 minutes"})]})]}),(a.status==="dispatched"||a.status==="nearby")&&e.jsx("div",{className:"mb-6",children:e.jsx(ea,{orderId:a.id,customerLocation:a.deliveryLocation,estimatedDelivery:"15-20 minutes"})}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg",children:"Order Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order ID"}),e.jsx("span",{className:"font-medium",children:a.id})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date & Time"}),e.jsxs("span",{className:"font-medium",children:[new Date(a.timestamp).toLocaleDateString()," at"," ",new Date(a.timestamp).toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Location"}),e.jsx("span",{className:"font-medium",children:a.deliveryLocation})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Payment Method"}),e.jsx("span",{className:"font-medium",children:a.paymentMethod})]}),e.jsxs("div",{className:"border-t border-border pt-3",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["KES ",a.total-a.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{children:["KES ",a.deliveryFee]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-primary",children:["KES ",a.total]})]})]})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card mt-6",children:[e.jsxs("h2",{className:"font-semibold text-lg mb-4",children:["Items (",a.items.length,")"]}),e.jsx("div",{className:"space-y-3",children:a.items.map((m,u)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[m.quantity,"x ",m.menuItem.name]}),e.jsxs("span",{className:"font-medium",children:["KES ",m.menuItem.price*m.quantity]})]},u))})]}),e.jsxs(k,{onClick:()=>t("/cart"),className:"w-full mt-6 bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center gap-2 h-12 font-medium",children:[e.jsx(Js,{className:"w-5 h-5"}),"Back to Orders"]})]})]})}function ta({open:s,onOpenChange:t,user:a,onSave:l}){const[n,c]=d.useState({id:"",username:"",password:"",fullName:"",phone:"",location:"",role:"user",profileImage:""});d.useEffect(()=>{a&&c(a)},[a,s]);const m=u=>{u.preventDefault(),l(n),t(!1)};return e.jsx(es,{open:s,onOpenChange:t,children:e.jsxs(ss,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ts,{children:e.jsx(as,{children:"Edit Profile"})}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{htmlFor:"profileImage",className:"text-base font-medium",children:"Profile Image"}),e.jsx("div",{className:"w-full",children:e.jsx(jt,{value:n.profileImage||"",onChange:u=>c({...n,profileImage:u}),placeholder:"Choose Profile Image",className:"w-full h-32 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors"})})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"fullName",children:"Full Name"}),e.jsx(P,{id:"fullName",value:n.fullName,onChange:u=>c({...n,fullName:u.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"username",children:"Username"}),e.jsx(P,{id:"username",value:n.username,onChange:u=>c({...n,username:u.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"phone",children:"Phone"}),e.jsx(P,{id:"phone",value:n.phone,onChange:u=>c({...n,phone:u.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"location",children:"Default Location"}),e.jsxs(Q,{value:n.location,onValueChange:u=>c({...n,location:u}),children:[e.jsx(H,{children:e.jsx(Y,{})}),e.jsxs(G,{children:[e.jsx(j,{value:"CBD",children:"CBD"}),e.jsx(j,{value:"Mukima",children:"Mukima"}),e.jsx(j,{value:"Baraka",children:"Baraka"}),e.jsx(j,{value:"Mugambi",children:"Mugambi"}),e.jsx(j,{value:"Katheri",children:"Katheri"}),e.jsx(j,{value:"MKWE",children:"MKWE"}),e.jsx(j,{value:"Likii",children:"Likii"}),e.jsx(j,{value:"Makutano",children:"Makutano"}),e.jsx(j,{value:"Airstrip",children:"Airstrip"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"password",children:"New Password (Optional)"}),e.jsx(P,{id:"password",type:"password",value:n.password,onChange:u=>c({...n,password:u.target.value}),placeholder:"Leave blank to keep current password"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{type:"submit",className:"flex-1",children:"Save Changes"}),e.jsx(k,{type:"button",variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"Cancel"})]})]})]})})}function aa(){const s=O(),t=S.getCurrentUser(),[a,l]=d.useState(!1),n=()=>{S.setCurrentUser(null),window.dispatchEvent(new CustomEvent("userLogout")),T.success("Logged out successfully"),s("/home")},c=m=>{const i=S.getUsers().map(x=>x.id===m.id?m:x);S.saveUsers(i),S.setCurrentUser(m),T.success("Profile updated successfully")};return t?e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsx("header",{className:"bg-gradient-hero text-white",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-8 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white rounded-full mx-auto mb-4 flex items-center justify-center overflow-hidden",children:t.profileImage?e.jsx("img",{src:t.profileImage,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(Ce,{className:"w-10 h-10 text-primary"})}),e.jsx("h1",{className:"text-2xl font-bold mb-1",children:t.fullName}),e.jsxs("p",{className:"text-white/90",children:["@",t.username]}),e.jsxs(k,{onClick:()=>l(!0),variant:"outline",size:"sm",className:"mt-4 bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card space-y-4",children:[e.jsx("h2",{className:"font-semibold text-lg mb-4",children:"Account Information"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Full Name"}),e.jsx("p",{className:"font-medium",children:t.fullName})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-muted rounded-full flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Default Location"}),e.jsx("p",{className:"font-medium",children:t.location})]})]})]}),t.role==="admin"&&e.jsxs("button",{onClick:()=>s("/admin"),className:"w-full bg-card rounded-xl p-4 shadow-card hover:shadow-hover transition-shadow flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Admin Panel"}),e.jsx(He,{className:"w-5 h-5 text-muted-foreground"})]}),e.jsxs(k,{onClick:n,variant:"destructive",className:"w-full h-12 text-base",children:[e.jsx(st,{className:"w-5 h-5 mr-2"}),"Logout"]}),e.jsx("div",{className:"text-center pt-4",children:e.jsx("img",{src:ie,alt:"Discover Mount Kenya",className:"h-16 w-auto mx-auto mb-2 opacity-50 object-contain"})})]}),e.jsx(ta,{open:a,onOpenChange:l,user:t,onSave:c}),e.jsx(_,{})]}):(s("/login"),null)}function ra({show:s=!1}){return s?e.jsxs("div",{className:"text-center py-8 mb-4 text-xs text-muted-foreground border-t border-zinc-100 dark:border-zinc-800 mx-4",children:["Developed by"," ",e.jsx("a",{href:"https://vairal.co.ke",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:"Vairal Media"})]}):null}function na(){const[s,t]=d.useState({name:"",organizationType:"",location:"",phone:"",message:""}),a=n=>{n.preventDefault();const c=`
*New Business Inquiry - Discover Mount Kenya*

*Name:* ${s.name}
*Organization Type:* ${s.organizationType}
*Location:* ${s.location}
*Phone:* ${s.phone}

*Message:*
${s.message}

---
_This inquiry was submitted through the Discover Mount Kenya app._
    `.trim(),m=`https://wa.me/254756253477?text=${encodeURIComponent(c)}`;window.open(m,"_blank"),t({name:"",organizationType:"",location:"",phone:"",message:""}),T.success("WhatsApp opened. Please send your inquiry.")},l=()=>{window.location.href="tel:+254711672672"};return e.jsxs("div",{className:"min-h-screen bg-background pb-20 animate-slide-left-fade",children:[e.jsx(R,{}),e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary rounded-xl flex items-center justify-center",children:e.jsx(_e,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Discover Mount Kenya"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mount Kenya's Premier Destination"})]})]}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-300 leading-relaxed text-sm mt-2",children:"Mount Kenya is not meant to be discovered randomly. Most visitors experience fragments. Good places hidden behind poor discovery. Exceptional service buried under noise. Quality diluted by volume."}),e.jsx("p",{className:"text-zinc-600 dark:text-zinc-300 leading-relaxed text-sm mt-3",children:"Discover Mount Kenya exists to change that. This is a private concierge, built for travellers and residents who value taste, trust, and discretion. Every stay, wellness service, activity, meal, and gift is selected with intent. Partners are vetted. Standards are non-negotiable."}),e.jsxs(k,{onClick:l,className:"w-full bg-primary hover:bg-primary/90 text-white mt-4",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Contact Us"]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-card border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-primary rounded-xl flex items-center justify-center",children:e.jsx(tt,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Partner With Us"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Feature your Business"})]})]}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"name",className:"text-sm",children:"Your Name *"}),e.jsx(P,{id:"name",value:s.name,onChange:n=>t({...s,name:n.target.value}),required:!0,placeholder:"Enter your full name",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"organizationType",className:"text-sm",children:"Type of Organization *"}),e.jsxs(Q,{value:s.organizationType,onValueChange:n=>t({...s,organizationType:n}),children:[e.jsx(H,{className:"text-sm",children:e.jsx(Y,{placeholder:"Select organization type"})}),e.jsxs(G,{children:[e.jsx(j,{value:"Accommodation",children:"Accommodation"}),e.jsx(j,{value:"Restaurant",children:"Restaurant"}),e.jsx(j,{value:"Beverage Outlet",children:"Beverage Outlet"}),e.jsx(j,{value:"Activities",children:"Activities"}),e.jsx(j,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"location",className:"text-sm",children:"County *"}),e.jsxs(Q,{value:s.location,onValueChange:n=>t({...s,location:n}),children:[e.jsx(H,{className:"text-sm",children:e.jsx(Y,{placeholder:"Select county"})}),e.jsxs(G,{children:[e.jsx(j,{value:"Nyeri County",children:"Nyeri County"}),e.jsx(j,{value:"Laikipia County",children:"Laikipia County"}),e.jsx(j,{value:"Meru County",children:"Meru County"}),e.jsx(j,{value:"Isiolo County",children:"Isiolo County"}),e.jsx(j,{value:"Kirinyaga County",children:"Kirinyaga County"}),e.jsx(j,{value:"Embu County",children:"Embu County"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"phone",className:"text-sm",children:"Contact Phone *"}),e.jsx(P,{id:"phone",type:"tel",value:s.phone,onChange:n=>t({...s,phone:n.target.value}),required:!0,placeholder:"Enter your phone number",className:"text-sm"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message",className:"text-sm",children:"Additional Details"}),e.jsx(rs,{id:"message",value:s.message,onChange:n=>t({...s,message:n.target.value}),placeholder:"Tell us more about your business and partnership interests...",rows:4,className:"text-sm"})]}),e.jsxs(k,{type:"submit",className:"w-full bg-primary hover:bg-primary/90 text-white",children:[e.jsx(at,{className:"w-4 h-4 mr-2"}),"Send Inquiry"]})]})]})]}),e.jsx(ra,{show:!0}),e.jsx(_,{})]})}const ia=()=>{const s=J();return d.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),e.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),e.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},oa=()=>{const[s,t]=d.useState(null),[a,l]=d.useState(!1),[n,c]=d.useState(!1);return d.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches?(c(!0),!0):!1)return;const i=()=>{"serviceWorker"in navigator&&document.querySelector('link[rel="manifest"]')&&l(!0)},x=v=>{v.preventDefault(),t(v),l(!0)},f=()=>{c(!0),l(!1),t(null)};return i(),window.addEventListener("beforeinstallprompt",x),window.addEventListener("appinstalled",f),()=>{window.removeEventListener("beforeinstallprompt",x),window.removeEventListener("appinstalled",f)}},[]),{isInstallable:a,isInstalled:n,installApp:async()=>{if(s)try{await s.prompt();const{outcome:u}=await s.userChoice;if(u==="accepted")return c(!0),l(!1),t(null),!0}catch(u){console.error("Error installing PWA:",u)}else try{if("serviceWorker"in navigator&&"PushManager"in window){const u=await navigator.serviceWorker.getRegistration();u&&await u.update()}}catch(u){console.error("Error with installation:",u)}return!1}}};function la(){const{isInstallable:s,isInstalled:t,installApp:a}=oa(),l=J(),[n,c]=d.useState(!1);if(d.useEffect(()=>{c(!1)},[l.pathname]),l.pathname.includes("admin")||l.pathname.includes("dmk-login-admin"))return null;const m=async()=>{await a()&&T.success("App installed successfully!")},u=()=>{c(!0)};return!s||t||n?null:e.jsx("div",{id:"pwa-install-prompt",className:"fixed bottom-20 left-4 right-4 z-50 animate-in slide-in-from-bottom-5 duration-500",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-md dark:bg-slate-900/95 border border-primary/20 shadow-xl rounded-2xl p-6 text-center space-y-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center mx-auto",children:e.jsx(rt,{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-foreground text-lg",children:"Download for Offline Access"}),e.jsx("p",{className:"text-sm text-primary font-bold italic leading-relaxed px-2",children:'"Crafted experiences. Trusted places."'}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed px-2 pt-1 border-t border-primary/5",children:"Add to home screen for a fast, native app experience that works anywhere, even without internet."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[e.jsxs(k,{onClick:m,className:"flex-1 bg-primary hover:bg-primary/90 text-white shadow-lg h-10",children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),"Install Now"]}),e.jsxs(k,{onClick:u,className:"flex-1 text-white shadow-sm h-10 border-0",style:{backgroundColor:"#800020"},children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Not Now"]})]})]})})}function ca(s={}){const{immediate:t=!1,onNeedRefresh:a,onOfflineReady:l,onRegistered:n,onRegisteredSW:c,onRegisterError:m}=s;let u,i;const x=async(v=!0)=>{await i};async function f(){if("serviceWorker"in navigator){if(u=await St(async()=>{const{Workbox:v}=await import("./vendor-react-DKtqgGsc.js").then(y=>y.bv);return{Workbox:v}},__vite__mapDeps([0,1])).then(({Workbox:v})=>new v("/discovermtkenya/sw.js",{scope:"/discovermtkenya/",type:"classic"})).catch(v=>{m==null||m(v)}),!u)return;u.addEventListener("activated",v=>{(v.isUpdate||v.isExternal)&&window.location.reload()}),u.addEventListener("installed",v=>{v.isUpdate||l==null||l()}),u.register({immediate:t}).then(v=>{c?c("/discovermtkenya/sw.js",v):n==null||n(v)}).catch(v=>{m==null||m(v)})}}return i=f(),x}const ys=()=>{if("serviceWorker"in navigator){const s=ca({onNeedRefresh(){confirm("New content available. Reload to update?")&&s(!0)},onOfflineReady(){console.log("App is ready for offline use")}})}};function da(){const{pathname:s}=J();return d.useEffect(()=>{window.scrollTo(0,0)},[s]),null}const F=new it({defaultOptions:{queries:{staleTime:1e3*60*5,gcTime:1e3*60*60*24*7,retry:3,retryDelay:s=>Math.min(1e3*2**s,1e4),refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:!0},mutations:{retry:1,retryDelay:1e3}}}),ma={persistClient:async s=>{await ct("react-query-cache",s)},restoreClient:async()=>await dt("react-query-cache"),removeClient:async()=>{await mt("react-query-cache")}},ua=()=>{const s=J();return e.jsx(ut,{mode:"wait",children:e.jsxs(xt,{location:s,children:[e.jsx(I,{path:"/",element:e.jsx(ht,{to:"/splash",replace:!0})}),e.jsx(I,{path:"/splash",element:e.jsx(Rt,{})}),e.jsx(I,{path:"/login",element:e.jsx(ke,{})}),e.jsx(I,{path:"/dmk-login-admin",element:e.jsx(ke,{})}),e.jsx(I,{path:"/create-account",element:e.jsx($t,{})}),e.jsx(I,{path:"/home",element:e.jsx(zt,{})}),e.jsx(I,{path:"/categories",element:e.jsx(Ut,{})}),e.jsx(I,{path:"/category/:category",element:e.jsx(Qt,{})}),e.jsx(I,{path:"/business/:id",element:e.jsx(Yt,{})}),e.jsx(I,{path:"/cart",element:e.jsx(Gt,{})}),e.jsx(I,{path:"/checkout",element:e.jsx(Xt,{})}),e.jsx(I,{path:"/order-tracking/:id",element:e.jsx(sa,{})}),e.jsx(I,{path:"/profile",element:e.jsx(aa,{})}),e.jsx(I,{path:"/settings",element:e.jsx(na,{})}),e.jsx(I,{path:"/admin",element:e.jsx(vt,{})}),e.jsx(I,{path:"/admin/partners",element:e.jsx(yt,{})}),e.jsx(I,{path:"/admin/menus",element:e.jsx(bt,{})}),e.jsx(I,{path:"/admin/users",element:e.jsx(Nt,{})}),e.jsx(I,{path:"/admin/reviews",element:e.jsx(wt,{})}),e.jsx(I,{path:"/admin/analytics",element:e.jsx(Ct,{})}),e.jsx(I,{path:"*",element:e.jsx(ia,{})})]},s.pathname)})},xa=()=>{const[s,t]=d.useState({progress:0,status:"Initializing...",isComplete:!1,isVisible:!1});return d.useEffect(()=>{ys();const a=async()=>{try{const m=await fetch("https://raw.githubusercontent.com/Vairal77/discovermtkenya/main/public/version.json");if(m.ok){const u=await m.json(),i=localStorage.getItem("dmk_app_version");i&&i!==u.version?(console.log("DMK: New version detected, updating assets..."),localStorage.setItem("dmk_app_version",u.version)):i||localStorage.setItem("dmk_app_version",u.version)}}catch{console.log("DMK: Update check failed (offline or GitHub unreachable)")}};a();const l=async()=>{if(console.log("DMK: Starting deep EXHAUSTIVE cache warming..."),!sessionStorage.getItem("dmk_sync_complete")){t(m=>({...m,isVisible:!1,status:"Connecting to server..."}));try{const m="https://vwhgnzioqrhjgvxffuyq.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ3aGduemlvcXJoamd2eGZmdXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNzg2NzksImV4cCI6MjA3Njk1NDY3OX0.IukGQw9fwHFKWNsmhea-5z4fCOZ8S4b6G3QET1JrHSU",i={apikey:u,Authorization:`Bearer ${u}`,"Content-Type":"application/json"};t(o=>({...o,progress:10,status:"Downloading Partner database..."}));const x=await fetch(`${m}/rest/v1/partners?select=*`,{headers:i}).then(o=>o.json());if(!Array.isArray(x))throw new Error("Invalid partners data");F.setQueryData(["partners"],x),F.setQueryData(["partners","categories"],x),F.setQueryData(["partners","promoted","home"],x.filter(o=>o.promoted)),F.setQueryData(["partners","promoted","categories"],x.filter(o=>o.promoted)),t(o=>({...o,progress:30,status:"Syncing Business Menus..."}));const f=await fetch(`${m}/rest/v1/menu_items?select=*`,{headers:i}).then(o=>o.json());if(!Array.isArray(f))throw new Error("Invalid menu items data");[...new Set(x.map(o=>o.category))].forEach(o=>{const N=x.filter(h=>h.category===o);F.setQueryData(["partners","category",o],N)}),x.forEach((o,N)=>{const h=f.filter(C=>C.partner_id===o.id);if(F.setQueryData(["partner",o.id],o),F.setQueryData(["menu",o.id],h),N%5===0){const C=30+N/x.length*20;t(g=>({...g,progress:C,status:`Processing ${o.name}...`}))}}),Object.entries({restaurant:["restaurants","restaurant","food delivery"],beverage:["beverages","beverage"],accommodation:["accommodation"],activities:["activities"],attractions:["attractions"],shop:["shop","dmk shop"]}).forEach(([o,N])=>{const h=x.filter(C=>C.category===o);N.forEach(C=>{F.setQueryData(["partners","category",C],h)})}),t(o=>({...o,progress:50,status:"Downloading offline media assets..."}));const r=new Set;x.forEach(o=>{o.image&&(Array.isArray(o.image)?o.image.forEach(N=>r.add(N)):r.add(o.image))}),f.forEach(o=>{o.image&&r.add(o.image)}),r.add("media/foodhero.jpg"),r.add("media/foodhero.jpg"),r.add("media/beverageshero.jpg"),r.add("media/activitieshero.jpg"),r.add("media/shophero.jpg"),r.add("media/homehero.jpg"),r.add("media/categorieshero.jpg"),r.add("media/accommodationhero.jpg"),r.add("media/attractionshero.jpg"),r.add("media/splash.gif"),r.add("media/accommodation.jpg"),r.add("media/food.jpg"),r.add("media/beverages.jpg"),r.add("media/activities.jpg"),r.add("media/attractions.jpg"),r.add("media/shop.jpg");const w=Array.from(r).filter(o=>o&&o.startsWith("http"));let D=0;const p=10;for(let o=0;o<w.length;o+=p){const N=w.slice(o,o+p);await Promise.all(N.map(C=>new Promise(g=>{const b=new Image;b.src=`${C}?v=${Date.now()}`,b.onload=g,b.onerror=g}))),D+=N.length;const h=50+D/w.length*50;t(C=>({...C,progress:h,status:`Caching image ${D} of ${w.length}...`}))}console.log(`DMK: Offline sync complete. ${r.size} images cached.`),t(o=>({...o,progress:100,status:"Offline Ready",isComplete:!0})),sessionStorage.setItem("dmk_sync_complete","true"),t(o=>({...o,isVisible:!1}))}catch(m){console.error("Deep cache warmer failed:",m),t(u=>({...u,status:"Sync paused - waiting for network",isVisible:!1}))}}},n=setTimeout(l,2e3),c=setInterval(()=>{navigator.onLine&&(console.log("DMK: Running periodic background sync..."),sessionStorage.removeItem("dmk_sync_complete"),a(),l())},1e3*60*15);return()=>{clearTimeout(n),clearInterval(c)}},[]),e.jsx(ot,{client:F,persistOptions:{persister:ma,maxAge:1e3*60*60*24*7},onSuccess:()=>{F.resumePausedMutations()},children:e.jsxs(Ft,{children:[e.jsx(Ot,{}),e.jsx(Kt,{}),e.jsxs(lt,{basename:"/discovermtkenya",children:[e.jsx(da,{}),e.jsx(ua,{}),e.jsx(la,{})]})]})})};ys();gt(document.getElementById("root")).render(e.jsx(xa,{}));
